var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(a,o){function i(t){try{l(n.next(t))}catch(e){o(e)}}function s(t){try{l(n["throw"](t))}catch(e){o(e)}}function l(t){t.done?a(t.value):new r(function(e){e(t.value)}).then(i,s)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(i=l.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){l.label=r[1];break}if(6===r[0]&&l.label<i[1]){l.label=i[1],i=r;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(r);break}i[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(t,l)}catch(n){r=[6,n],o=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var a,o,i,s,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Lib;!function(t){var e=function(){function t(){this.count=0,this.items=new Array}return Object.defineProperty(t.prototype,"Count",{get:function(){return this.count},enumerable:!0,configurable:!0}),t.prototype.GetKeys=function(){var t;for(var e in this.items)t.push(e);return t},t.prototype.GetValues=function(){var t;for(var e in this.items)t.push(this.items[e]);return t},t.prototype.Get=function(t){return this.ContainsKey(t)?this.items[t]:null},t.prototype.Set=function(t,e){this.ContainsKey(t)||this.count++,this.items[t]=e},t.prototype.Clear=function(){this.count=0,this.items={}},t.prototype.ContainsKey=function(t){return t in this.items},t.prototype.Remove=function(t){return this.ContainsKey(t)?(this.count--,delete this.items[t],!0):!1},t.prototype.ForEachKey=function(t,e){void 0===e&&(e=null);for(var r in this.items)if(t(r),null!=e&&e())break},t.prototype.ForEach=function(t,e){void 0===e&&(e=null);for(var r in this.items)if(t(r,this.items[r]),null!=e&&e())break},t}();t.Dictionary=e,__reflect(e.prototype,"Lib.Dictionary")}(Lib||(Lib={}));var Lib;!function(t){var e=function(){function t(){}return t.prototype.Release=function(){return null==this.pool?void console.info("重复Release"):(this.pool.Free(this),void(this.pool=null))},t}();t.PoolableObj=e,__reflect(e.prototype,"Lib.PoolableObj",["Lib.IPoolableObj"]);var r=function(){function e(){this.stacks=new t.Dictionary}return e.prototype.Get=function(t,e){if(this.stacks.ContainsKey(t)){var r=this.stacks.Get(t);if(r.length>0){var n=r.pop();return n.pool=this,n}}var a=e();return a.pool=this,a},e.prototype.Free=function(t){var e;this.stacks.ContainsKey(t.className)?e=this.stacks.Get(t.className):(e=new Array,this.stacks.Set(t.className,e)),t.pool=null,e.push(t)},e.prototype.Clear=function(t){this.stacks.Remove(t)},e.prototype.ClearAll=function(){this.stacks.Clear()},e.Instance=new e,e}();t.ObjectPool=r,__reflect(r.prototype,"Lib.ObjectPool")}(Lib||(Lib={}));var Lib;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enabled=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"GameObject",{get:function(){return null==this.ownerComponentManager?null:this.ownerComponentManager.gameObject},enumerable:!0,configurable:!0}),e.prototype.Start=function(){},e.prototype.Update=function(){},e.prototype.Release=function(){this.ownerComponentManager=null,t.prototype.Release.call(this)},e}(t.PoolableObj);t.GameObjectComponent=e,__reflect(e.prototype,"Lib.GameObjectComponent")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.OnEnd=function(){null!=this.onEnd&&this.onEnd()},e.prototype.Init=function(t){this.stageBattlefieldController=t},e.prototype.Release=function(){this.stageBattlefieldController=null,t.prototype.Release.call(this)},e}(Lib.GameObjectComponent);t.RoomController=e,__reflect(e.prototype,"DayDayUp.RoomController")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"ShowOffsetX",{get:function(){return this.rootGameObject.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShowOffsetY",{get:function(){return this.rootGameObject.y},enumerable:!0,configurable:!0}),e.prototype.SetShowOffset=function(t,e){this.rootGameObject.x=t,this.rootGameObject.y=e},Object.defineProperty(e.prototype,"Id",{get:function(){return this.data.id},enumerable:!0,configurable:!0}),e.prototype.Init=function(t,e,r){this.ownerStageBattlefield=e,this.data=r,this.commands=Lib.Command_Commands.New(t,this.commands,!1,null)},e.prototype.Release=function(){this.GameObject.x=0,this.GameObject.y=0,this.GameObject.scaleX=1,this.GameObject.scaleY=1,this.ownerStageBattlefield=null,this.data=null,this.commands.Release(),this.commands=null,this.rootGameObject.x=0,this.rootGameObject.y=0,this.rootGameObject.scaleX=1,this.rootGameObject.scaleY=1,this.rootGameObject=null,t.prototype.Release.call(this)},e.prototype.Start=function(){t.prototype.Start.call(this),this.rootGameObject=Lib.GameObject.New(this.ownerComponentManager.pool,!1),this.GameObject.addChild(this.rootGameObject)},e.prototype.Update=function(){this.data.faceToRight?this.GameObject.scaleX>0&&(this.GameObject.scaleX*=-1):this.GameObject.scaleX<0&&(this.GameObject.scaleX*=-1),this.GameObject.x=this.data.x*this.ownerStageBattlefield.viewWidth/this.data.ownerBattlefield.setting.showWidth,this.GameObject.y=this.ownerStageBattlefield.viewHeight-(this.data.ownerBattlefield.curBottomPos-this.data.y)*this.ownerStageBattlefield.viewHeight/this.data.ownerBattlefield.setting.showHeight,this.commands.Update()},e.prototype.GetBodyRect=function(){return new Rectangle(this.data.body.x*this.ownerStageBattlefield.viewWidth/this.data.ownerBattlefield.setting.showWidth,this.data.body.y*this.ownerStageBattlefield.viewHeight/this.data.ownerBattlefield.setting.showHeight,this.data.body.width*this.ownerStageBattlefield.viewWidth/this.data.ownerBattlefield.setting.showWidth,this.data.body.height*this.ownerStageBattlefield.viewHeight/this.data.ownerBattlefield.setting.showHeight)},Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyAlpha",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LineColor",{get:function(){return 16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LineThickness",{get:function(){return 1},enumerable:!0,configurable:!0}),e.prototype.DrawBody=function(){var t=this.GetBodyRect(),e=new egret.Shape;e.graphics.beginFill(this.BodyColor,this.BodyAlpha),e.graphics.lineStyle(this.LineThickness,this.LineColor),e.graphics.drawRect(t.x,t.y,t.width,t.height),e.graphics.endFill(),this.GameObject.addChild(e)},e}(Lib.GameObjectComponent);t.StageBattlefieldItem=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldItem")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.x=0,e.y=0,e.body=new Rectangle,e.faceToRight=!0,e.needRemoved=!1,e}return __extends(e,t),e.prototype.GetLastDeltaX=function(){return this.x-this.lastX},e.prototype.GetLastDeltaY=function(){return this.y-this.lastY},e.prototype.Init=function(t,e,r){this.ownerBattlefield=t,this.id=e,this.faceToRight=r,this.x=0,this.y=0,this.lastX=0,this.lastY=0,this.needRemoved=!1},e.prototype.Release=function(){this.ownerBattlefield=null,t.prototype.Release.call(this)},e.prototype.Update=function(){this.lastX=this.x,this.lastY=this.y},e.Touched=function(t,e,r,n,a,o,i,s){return r>0&&n>0&&i>0&&s>0&&a+i>t&&t+r>a&&o+s>e&&e+n>o},e}(Lib.PoolableObj);t.BattlefieldItem=e,__reflect(e.prototype,"DayDayUp.BattlefieldItem")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"Scale",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Prop",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(t.StageBattlefieldItem);t.StageBattlefieldProp=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldProp")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e;!function(t){t[t.None=-1]="None",t[t.Normal=0]="Normal",t[t.Bubble=1]="Bubble",t[t.Conveyor=2]="Conveyor",t[t.Ground=3]="Ground",t[t.Ice=4]="Ice",t[t.Marsh=5]="Marsh",t[t.Quicksand=6]="Quicksand",t[t.Spring=7]="Spring",t[t.COUNT=8]="COUNT"}(e=t.BattlefieldBoardTypeEnum||(t.BattlefieldBoardTypeEnum={}));var r=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.startX=0,e.startY=0,e.amplitudeX=0,e.amplitudeY=0,e.amplitudeFrameCount=0,e}return __extends(r,t),Object.defineProperty(r.prototype,"Type",{get:function(){return e.None},enumerable:!0,configurable:!0}),r.prototype.SetStartPos=function(t,e){this.startX=t,this.startY=e,this.x=this.startX,this.y=this.startY,this.lastX=this.startX,this.lastY=this.startY},r.prototype.GetGroundOffsetMax=function(){return 0},r.prototype.GetGroundOffsetPerFrame=function(){return 0},r.prototype.GetGroundSpeed=function(){return 0},r.prototype.GetPlayerRunSpeedRate=function(){return 1},r.prototype.GetPlayerJumpSpeedRate=function(){return 1},r.prototype.GetPlayerSuperJumpSpeedRate=function(){return 1},r.prototype.Init_Board=function(e,r,n,a,o,i){t.prototype.Init.call(this,e,r,n),this.style=i,this.body.setTo(.5*-a,0,a,o),this.amplitudeX=0,this.amplitudeY=0,this.amplitudeFrameCount=0},r.prototype.Update=function(){t.prototype.Update.call(this),this.amplitudeFrameCount>0&&(this.x=this.startX+Math.sin(this.ownerBattlefield.finishedFrameCount/this.amplitudeFrameCount)*this.amplitudeX,this.y=this.startY+Math.sin(this.ownerBattlefield.finishedFrameCount/this.amplitudeFrameCount)*this.amplitudeY),this.y>=this.ownerBattlefield.curBottomPos+.5*this.ownerBattlefield.setting.showHeight&&(this.needRemoved=!0)},r}(t.BattlefieldItem);t.BattlefieldBoard=r,__reflect(r.prototype,"DayDayUp.BattlefieldBoard")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"Board",{get:function(){return this.data},enumerable:!0,configurable:!0}),e.prototype.WhenTrampled=function(t){var e=Lib.Command_Steps.New(this.ownerComponentManager.pool,!1,null);this.rootGameObject.y=10,e.Add(Lib.Command_LocalPosition.New(this.ownerComponentManager.pool,this.rootGameObject,this.rootGameObject.x,this.rootGameObject.y,this.rootGameObject.x,0,.1,2,!1,null)),this.commands.Add(e)},e}(t.StageBattlefieldItem);t.StageBattlefieldBoard=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e;!function(t){t[t.None=-1]="None",t[t.Feather=0]="Feather",t[t.Drinks=1]="Drinks",t[t.SpringShoe=2]="SpringShoe",t[t.TurtleShell=3]="TurtleShell",t[t.Chicken=4]="Chicken",t[t.TurnBack=5]="TurnBack",t[t.COUNT=6]="COUNT"}(e=t.BattlefieldPropTypeEnum||(t.BattlefieldPropTypeEnum={}));var r=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.atBoardId=-1,e}return __extends(r,t),Object.defineProperty(r.prototype,"Type",{get:function(){return e.None},enumerable:!0,configurable:!0}),r.prototype.GetAtBoard=function(){return this.ownerBattlefield.boards.Get(this.atBoardId)},r.prototype.AdjustAtBoard=function(){var t=this.GetAtBoard();null!=t&&(this.x=t.x,this.y=t.y+t.body.top-this.body.bottom-.5*this.body.height)},r.prototype.Init_Prop=function(e,r,n){t.prototype.Init.call(this,e,r,!0),this.atBoardId=n;var a=.5,o=.5;this.body.setTo(.5*-a,0,a,o),this.AdjustAtBoard()},r.prototype.Update=function(){t.prototype.Update.call(this);var e=this.GetAtBoard();null!=e?this.AdjustAtBoard():this.needRemoved=!0},r.prototype.TouchPlayer=function(t){this.needRemoved=!0,t.AddProp(this.Type)},r}(t.BattlefieldItem);t.BattlefieldProp=r,__reflect(r.prototype,"DayDayUp.BattlefieldProp")}(DayDayUp||(DayDayUp={}));var Rectangle=egret.Rectangle,GameObjectBase=egret.Sprite,DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t.lastLevelMax=-1,t}return __extends(r,e),r.New=function(t,e,n){var a=null==t?new r:t.Get(r.ClassName,function(){return new r});return a.Init(e),a.ui=n,a},r.NewWithGameObject=function(e,n,a,o){var i=Lib.GameObject.New(Lib.ObjectPool.Instance),s=t.StageBattlefield.New(i.pool,e,n-e/4,a);i.components.Add(s);var l=t.StageBattlefieldController_Manual.New(i.pool,s);i.components.Add(l);var u=r.New(i.pool,l,o);return i.components.Add(u),u},r.prototype.Update=function(){e.prototype.Update.call(this),this.RefreshUI();var r=this.stageBattlefieldController.stageBattlefield.battlefield.MainPlayer;if(null!=r)switch(r.state){case t.BattlefieldPlayerStateEnum.Dead:console.info("最高层数 "+this.lastLevelMax),this.OnEnd()}},r.prototype.Release=function(){this.ui=null,this.lastLevelMax=-1,e.prototype.Release.call(this)},r.prototype.RefreshUI=function(){if(null!=this.ui){var e=this.stageBattlefieldController.stageBattlefield.battlefield.MainPlayer;if(null!=e){this.lastLevelMax!=e.LevelMax&&(this.lastLevelMax=e.LevelMax,this.ui.bitmapLabel_Level.text=this.lastLevelMax.toString()),this.ui.progressBar_JumpPower.value=100*e.curJumpPower/e.ownerBattlefield.setting.jumpPowerMax,e.curJumpPower>=e.ownerBattlefield.setting.jumpPowerMax?(this.ui.image_JumpPower_Blue.visible=!1,this.ui.image_JumpPower_Red.visible=!0):(this.ui.image_JumpPower_Blue.visible=!0,this.ui.image_JumpPower_Red.visible=!1),this.ui.progressBar_SuperForce.value=100*e.curSuperForce/e.ownerBattlefield.setting.superForceMax,e.curSuperForce>=e.ownerBattlefield.setting.superForceMax?(this.ui.image_SuperForceMax_False.visible=!1,this.ui.image_SuperForceMax_True.visible=!0):(this.ui.image_SuperForceMax_False.visible=!0,this.ui.image_SuperForceMax_True.visible=!1);var r=e.GetPropLeftFrameCount(t.BattlefieldPropTypeEnum.Feather);switch(r>0?(this.ui.bitmapLabel_Feather.text=Math.ceil(r/e.ownerBattlefield.setting.fps).toString(),this.ui.group_Feather.visible=!0):this.ui.group_Feather.visible=!1,r=e.GetPropLeftFrameCount(t.BattlefieldPropTypeEnum.Drinks),r>0?(this.ui.bitmapLabel_Drinks.text=Math.ceil(r/e.ownerBattlefield.setting.fps).toString(),this.ui.group_Drinks.visible=!0):this.ui.group_Drinks.visible=!1,r=e.GetPropLeftFrameCount(t.BattlefieldPropTypeEnum.SpringShoe),r>0?(this.ui.bitmapLabel_SpringShoe.text=Math.ceil(r/e.ownerBattlefield.setting.fps).toString(),this.ui.group_SpringShoe.visible=!0):this.ui.group_SpringShoe.visible=!1,r=e.GetPropLeftFrameCount(t.BattlefieldPropTypeEnum.TurtleShell),r>0?(this.ui.bitmapLabel_TurtleShell.text=Math.ceil(r/e.ownerBattlefield.setting.fps).toString(),this.ui.group_TurtleShell.visible=!0):this.ui.group_TurtleShell.visible=!1,e.state){case t.BattlefieldPlayerStateEnum.JumpUp:case t.BattlefieldPlayerStateEnum.SuperJumpUp:e.record_levelAtOnceJump>=2&&(this.ui.bitmapLabel_JumpLevel.text=e.record_levelAtOnceJump.toString()+"层");var n=Math.ceil(-e.record_speedOfJump*e.ownerBattlefield.setting.fps*3.6);this.ui.bitmapLabel_JumpSpeed.text=n.toString()+"速";break;case t.BattlefieldPlayerStateEnum.Idle:case t.BattlefieldPlayerStateEnum.Run:this.ui.bitmapLabel_JumpLevel.text="",this.ui.bitmapLabel_JumpSpeed.text="";break;case t.BattlefieldPlayerStateEnum.Dead:null==t.SubScreenBattlefield_Solo_PlayRecord.lastRecord&&(t.SubScreenBattlefield_Solo_PlayRecord.lastRecord=e.ownerBattlefield.record.Clone())}}}},r.ClassName="RoomController_Solo",r}(t.RoomController);t.RoomController_Solo=e,__reflect(e.prototype,"DayDayUp.RoomController_Solo")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(){function e(){}return Object.defineProperty(e.prototype,"DisplayRoot",{get:function(){return this.owner.displayRoot_SubScreen},enumerable:!0,configurable:!0}),e.prototype.NewLoadingView=function(){return new t.LoadingView},e.prototype.Init=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this.owner=e,[4,this.owner.LoadResGroups(this.GetResGroupNames(),this.NewLoadingView)];case 1:return r.sent(),this.Start(),null!=this.BGMFilePath&&t.SoundManager.Instance.PlayBGM(this.BGMFilePath),[2]}})})},e.prototype.End=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return null!=this.BGMFilePath&&t.SoundManager.Instance.StopBGM(this.BGMFilePath),[2]})})},e}();t.SubScreen=e,__reflect(e.prototype,"Lib.SubScreen")}(Lib||(Lib={}));var Lib;!function(t){var e=function(){function t(){this.items=[]}return Object.defineProperty(t.prototype,"Count",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),t.prototype.Get=function(t){return this.items[t]},t.prototype.Add=function(t){this.items.push(t)},t.prototype.Contains=function(t){for(var e=0;e<this.items.length;e++)if(t==this.items[e])return!0;return!1},t.prototype.RemoveAt=function(t){this.items.splice(t,1)},t.prototype.Clear=function(){this.items.splice(0,this.items.length)},t.prototype.ForEach=function(t,e){void 0===e&&(e=null);for(var r=0;r<this.items.length&&(t(r,this.items[r]),null==e||!e());r++);},t.prototype.ForEachInverted=function(t,e){void 0===e&&(e=null);for(var r=this.items.length-1;r>=0&&(t(r,this.items[r]),null==e||!e());r--);},t}();t.List=e,__reflect(e.prototype,"Lib.List")}(Lib||(Lib={}));var Lib;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"DeltaTime",{get:function(){return this.maxSpeed?Number.MAX_VALUE:egret.getTimer()/1e3-this.startTime},enumerable:!0,configurable:!0}),e.prototype.Init=function(t,e){this.maxSpeed=t,this.endEvent=e,this.started=!1,this.removed=!1},e.prototype.Start=function(){this.started=!0,this.startTime=egret.getTimer()/1e3},e.prototype.Update=function(){this.started||this.Start()},e.prototype.End=function(){this.removed=!0,null!=this.endEvent&&this.endEvent(this)},e.prototype.Release=function(){this.endEvent=null,t.prototype.Release.call(this)},e.Commands_Clear=function(t){for(var e=0;e<t.Count;e++)t.Get(e).Release();t.Clear()},e.Commands_RemoveAt=function(t,e){t.Get(e).Release(),t.RemoveAt(e)},e}(t.PoolableObj);t.Command=e,__reflect(e.prototype,"Lib.Command")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.startTime=0,e}return __extends(e,t),e.prototype.Init=function(t){this.stageBattlefield=t,this.startTime=0},e.prototype.Release=function(){this.stageBattlefield=null,t.prototype.Release.call(this)},e.prototype.Start=function(){t.prototype.Start.call(this),this.startTime=egret.getTimer()/1e3},e}(Lib.GameObjectComponent);t.StageBattlefieldController=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldController")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(e){function r(t,r,n){var a=e.call(this)||this;return null!=t&&t.length>0&&(r=t+"/"+r),a.skinName="resource/Skin/UI/"+r+"UISkin.exml",a.onAddUIEvents=n,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.OnConfigComplete,a),a}return __extends(r,e),Object.defineProperty(r.prototype,"LogicScale",{get:function(){return 1},enumerable:!0,configurable:!0}),r.prototype.OnAddUIEvents=function(){null!=this.onAddUIEvents&&this.onAddUIEvents()},r.prototype.OnConfigComplete=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.OnConfigComplete,this),this.width=t.UIManager.Instance.logicScreenWidth/this.LogicScale,this.height=t.UIManager.Instance.logicScreenHeight/this.LogicScale,this.scaleX=this.stage.stageWidth/this.width,this.scaleY=this.stage.stageHeight/this.height},r.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.OnAddUIEvents()},r.prototype.Close=function(){t.UIManager.HideUI(this)},r}(eui.Component);t.UI=e,__reflect(e.prototype,"Lib.UI")}(Lib||(Lib={}));var Lib;!function(t){var e=function(t){function e(){var r=t.call(this)||this;return r.curSubScreen=null,e.instance=r,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.OnAddToStage,r),r}return __extends(e,t),Object.defineProperty(e,"Instance",{get:function(){return e.instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BackColor",{get:function(){return this.rect_BackColor.fillColor},set:function(t){this.rect_BackColor.fillColor=t},enumerable:!0,configurable:!0}),e.prototype.OnAddToStage=function(t){if(this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.OnAddToStage,this),this.logicScreenWidth=0,3*this.stage.stageWidth<=2*this.stage.stageHeight)this.logicScreenWidth=720,this.logicScreenHeight=Math.ceil(this.stage.stageHeight*this.logicScreenWidth/this.stage.stageWidth);else{var e=1680-400*(this.stage.stageHeight/this.stage.stageWidth);this.logicScreenWidth=Math.ceil(this.stage.stageWidth*e/this.stage.stageHeight),this.logicScreenHeight=Math.ceil(e)}egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){},egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.Init()["catch"](function(t){console.log(t)})},e.prototype.LoadTheme=function(){var t=this;return new Promise(function(e,r){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.Init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.displayRoot_SubScreen=new egret.DisplayObjectContainer,this.addChild(this.displayRoot_SubScreen),this.displayRoot_Box=new egret.DisplayObjectContainer,this.addChild(this.displayRoot_Box),this.displayRoot_Loading=new egret.DisplayObjectContainer,this.addChild(this.displayRoot_Loading),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return t.sent(),[4,this.LoadTheme()];case 2:return t.sent(),this.rect_BackColor=new eui.Rect(this.stage.stageWidth,this.stage.stageHeight),this.rect_BackColor.fillColor=0,this.stage.addChildAt(this.rect_BackColor,0),this.OnInited(),[2]}})})},e.prototype.OnInited=function(){console.info(wx.getBatteryInfoSync())},e.prototype.ChangeTo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return null==this.curSubScreen?[3,2]:[4,this.curSubScreen.End()];case 1:e.sent(),this.curSubScreen=null,this.displayRoot_SubScreen.removeChildren(),e.label=2;case 2:return this.curSubScreen=t,[4,this.curSubScreen.Init(this)];case 3:return e.sent(),[2]}})})},e.prototype.LoadResGroups=function(t,e){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(a){switch(a.label){case 0:return null==t||t.Count<=0?[2]:(r=!1,t.ForEach(function(t,e){RES.isGroupLoaded(e)||(r=!0)},function(){return r}),r?(n=e(),this.displayRoot_Loading.addChild(n),[4,n.LoadResGroups(t)]):[2]);case 1:return a.sent(),this.displayRoot_Loading.removeChild(n),[2]}})})},e.prototype.UnLoadResGroups=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:if(null==t||t.Count<=0)return[2];e=0,r.label=1;case 1:return e<t.Count?[4,RES.destroyRes(t.Get(e),!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},e.ShowUI=function(t){e.instance.displayRoot_Box.addChild(t)},e.HideUI=function(t){e.instance.displayRoot_Box.removeChild(t)},e}(egret.DisplayObjectContainer);t.UIManager=e,__reflect(e.prototype,"Lib.UIManager")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Ground",{get:function(){return this.data},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("93_png");r.texture=n,r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height,this.rootGameObject.addChild(r)},Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.WhenTrampled=function(t){},e.ClassName="StageBattlefieldBoard_Ground",e}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Ground=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Ground")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldPropTypeEnum.Chicken},enumerable:!0,configurable:!0}),r.prototype.TouchPlayer=function(t){e.prototype.TouchPlayer.call(this,t),t.curSuperForce+=t.ownerBattlefield.setting.prop_SuperForce_Chicken,t.curSuperForce>t.ownerBattlefield.setting.superForceMax&&(t.curSuperForce=t.ownerBattlefield.setting.superForceMax)},r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Prop(e,n,a),o},r.ClassName="BattlefieldProp_Chicken",r}(t.BattlefieldProp);t.BattlefieldProp_Chicken=e,__reflect(e.prototype,"DayDayUp.BattlefieldProp_Chicken")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldPropTypeEnum.Drinks},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Prop(e,n,a),o},r.ClassName="BattlefieldProp_Drinks",r}(t.BattlefieldProp);t.BattlefieldProp_Drinks=e,__reflect(e.prototype,"DayDayUp.BattlefieldProp_Drinks")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldPropTypeEnum.Feather},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Prop(e,n,a),o},r.ClassName="BattlefieldProp_Feather",r}(t.BattlefieldProp);t.BattlefieldProp_Feather=e,__reflect(e.prototype,"DayDayUp.BattlefieldProp_Feather")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldPropTypeEnum.SpringShoe},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Prop(e,n,a),o},r.ClassName="BattlefieldProp_SpringShoe",r}(t.BattlefieldProp);t.BattlefieldProp_SpringShoe=e,__reflect(e.prototype,"DayDayUp.BattlefieldProp_SpringShoe")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldPropTypeEnum.TurnBack},enumerable:!0,configurable:!0}),r.prototype.TouchPlayer=function(t){e.prototype.TouchPlayer.call(this,t),t.faceToRight=!t.faceToRight},r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Prop(e,n,a),o},r.ClassName="BattlefieldProp_TurnBack",r}(t.BattlefieldProp);t.BattlefieldProp_TurnBack=e,__reflect(e.prototype,"DayDayUp.BattlefieldProp_TurnBack")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldPropTypeEnum.TurtleShell},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Prop(e,n,a),o},r.ClassName="BattlefieldProp_TurtleShell",r}(t.BattlefieldProp);t.BattlefieldProp_TurtleShell=e,__reflect(e.prototype,"DayDayUp.BattlefieldProp_TurtleShell")}(DayDayUp||(DayDayUp={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,n){function a(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),r.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var DayDayUp;!function(t){var e=function(){function e(){this.players=new Lib.Dictionary}return e.prototype.Init=function(e){var r=this;e.players.ForEachKey(function(e){r.players.Set(e,new t.RecordPlayer(e))}),this.seed=e.setting.seed},e.prototype.AddFrame=function(t,e){var r=this;e.ForEach(function(e,n){var a=r.players.Get(e);a.AddFrame(t,n)})},e.prototype.CopyFrom=function(t){this.seed=t.seed,this.players=t.players},e.prototype.Clone=function(){var t=new e;return t.CopyFrom(this),t},e}();t.Record=e,__reflect(e.prototype,"DayDayUp.Record")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(){function e(t){this.frames=new Lib.List,this.playerId=t}return e.prototype.AddFrame=function(e,r){(this.frames.Count<=0||r!=this.GetLastInput())&&this.frames.Add(new t.RecordPlayerFrame(e,r))},e.prototype.GetLastInput=function(){return this.frames.Count>0&&this.frames.Get(this.frames.Count-1).input},e}();t.RecordPlayer=e,__reflect(e.prototype,"DayDayUp.RecordPlayer")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(){function t(t,e){this.input=!1,this.frameIndex=t,this.input=e}return t}();t.RecordPlayerFrame=e,__reflect(e.prototype,"DayDayUp.RecordPlayerFrame")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(){function t(){}return t}();t.Room=e,__reflect(e.prototype,"DayDayUp.Room")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),r.New=function(t,e){var n=null==t?new r:t.Get(r.ClassName,function(){return new r});return n.Init(e),n},r.NewWithGameObject=function(e,n){var a=Lib.GameObject.New(Lib.ObjectPool.Instance),o=new t.Battlefield(new t.BattlefieldSetting),i=t.StageBattlefield.New(a.pool,e,n-e/4,o);a.components.Add(i);var s=t.StageBattlefieldController_Ai.New(a.pool,i);a.components.Add(s);var l=r.New(a.pool,s);return a.components.Add(l),l},r.prototype.Update=function(){e.prototype.Update.call(this);var r=this.stageBattlefieldController.stageBattlefield.battlefield.MainPlayer;if(null!=r)switch(r.state){case t.BattlefieldPlayerStateEnum.Dead:this.OnEnd()}},r.ClassName="RoomController_Demo",r}(t.RoomController);t.RoomController_Demo=e,__reflect(e.prototype,"DayDayUp.RoomController_Demo")
}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),r.New=function(t,e,n){var a=null==t?new r:t.Get(r.ClassName,function(){return new r});return a.Init(e),a.ui=n,a},r.NewWithGameObject=function(e,n,a,o){var i=Lib.GameObject.New(Lib.ObjectPool.Instance),s=t.StageBattlefield.New(i.pool,e,n-e/4,a);i.components.Add(s);var l=t.StageBattlefieldController_Ai.New(i.pool,s);i.components.Add(l);var u=r.New(i.pool,l,o);return i.components.Add(u),u},r.ClassName="RoomController_Solo_PlayRecord",r}(t.RoomController_Solo);t.RoomController_Solo_PlayRecord=e,__reflect(e.prototype,"DayDayUp.RoomController_Solo_PlayRecord")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PlayCount",{get:function(){return isNaN(this.playCount)&&(this.playCount=Lib.LocalSetting_System.GetNumber("PlayCount",0)),this.playCount},set:function(t){egret.localStorage.setItem("PlayCount",t.toString()),this.playCount=t},enumerable:!0,configurable:!0}),t.instance=new t,t}();t.LocalSetting_DayDayUp=e,__reflect(e.prototype,"DayDayUp.LocalSetting_DayDayUp")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"LogicScale",{get:function(){return Lib.UIManager.Instance.logicScreenWidth/240},enumerable:!0,configurable:!0}),e}(Lib.UI);t.RoomController_SoloUI=e,__reflect(e.prototype,"DayDayUp.RoomController_SoloUI")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(){function e(e,r){void 0===r&&(r=null),this.objectPool=Lib.ObjectPool.Instance,this.boards=new Lib.Dictionary,this.props=new Lib.Dictionary,this.players=new Lib.Dictionary,this.finishedFrameCount=0,this.curBottomPos=0,this.lastRefreshMapIndex=0,this.lastRefreshRowIndex=0,this.setting=e,this.mapManager=new t.BattlefieldMapManager(this.setting.showWidth,this.setting.showHeight),this.random_main=new Lib.HLRandom(this.setting.seed),this.mainPlayerId=0;var n=this.CreateGround();this.RefreshBoards(),this.CreatePlayer(0,!0,n.id,-n.body.height),this.record=new t.Record,this.record.Init(this)}return Object.defineProperty(e.prototype,"MainPlayer",{get:function(){return this.players.Get(this.mainPlayerId)},enumerable:!0,configurable:!0}),e.prototype.OnBoard_Added=function(){null!=this.onBoard_Added&&this.onBoard_Added()},e.prototype.OnBoard_Removed=function(){null!=this.onBoard_Removed&&this.onBoard_Removed()},e.prototype.OnProp_Added=function(){null!=this.onProp_Added&&this.onProp_Added()},e.prototype.OnProp_Removed=function(){null!=this.onProp_Removed&&this.onProp_Removed()},e.prototype.OnPlayer_Added=function(){null!=this.onPlayer_Added&&this.onPlayer_Added()},e.prototype.OnPlayer_Removed=function(){null!=this.onPlayer_Removed&&this.onPlayer_Removed()},e.prototype.CreateGround=function(){var e=t.BattlefieldBoard_Ground.New(this.objectPool,this,0,!0);return e.SetStartPos(e.body.width/2,-e.body.height),this.boards.Set(e.id,e),this.OnBoard_Added(),e},e.prototype.CreatePlayer=function(e,r,n,a){var o=t.BattlefieldPlayer.New(this.objectPool,this,e,r,n,new t.BattlefieldPlayerRates);return o.x=this.setting.showWidth/4,o.y=a,this.players.Set(o.id,o),this.OnPlayer_Added(),o},e.prototype.RefreshBoards=function(){var t=this,e=this.curBottomPos-1.25*this.setting.showHeight;this.mapManager.RefreshBoards(this,this.lastRefreshMapIndex,this.lastRefreshRowIndex,e,function(e){t.boards.Set(e.id,e),t.OnBoard_Added()},function(e){t.props.Set(e.id,e),t.OnProp_Added()},function(e,r){t.lastRefreshMapIndex=e,t.lastRefreshRowIndex=r+1})},e.prototype.Update=function(t,e){var r=this;if(void 0===e&&(e=null),t<this.finishedFrameCount)return!1;this.record.AddFrame(this.finishedFrameCount,e);var n=new Lib.List;this.boards.ForEach(function(t,e){e.Update(),e.needRemoved&&n.Add(t)}),n.ForEach(function(t,e){r.boards.Get(e).Release(),r.boards.Remove(e),r.OnBoard_Removed()});var a=new Lib.List;this.props.ForEach(function(t,e){e.Update(),e.needRemoved&&a.Add(t)}),a.ForEach(function(t,e){r.props.Get(e).Release(),r.props.Remove(e),r.OnProp_Removed()});var o=new Lib.List;this.players.ForEach(function(t,r){r.onHolding=e.Get(t),r.Update(),r.needRemoved&&o.Add(t)}),o.ForEach(function(t,e){r.players.Get(e).Release(),r.players.Remove(e),r.OnPlayer_Removed()});var i=this.MainPlayer;return null!=i&&(this.curBottomPos=Math.min(this.curBottomPos,i.y+2*this.setting.showHeight/5)),this.RefreshBoards(),this.finishedFrameCount++,!0},e}();t.Battlefield=e,__reflect(e.prototype,"DayDayUp.Battlefield")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t.boards=new Lib.Dictionary,t.needSynBoardsByData=!0,t.props=new Lib.Dictionary,t.needSynPropsByData=!0,t.players=new Lib.Dictionary,t.needSynPlayersByData=!0,t.onHoldings=new Lib.Dictionary,t}return __extends(r,e),r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init(e,n,a),o},r.prototype.Init=function(t,e,r){this.viewWidth=t,this.viewHeight=e,this.battlefield=r,this.needSynBoardsByData=!0,this.needSynPropsByData=!0,this.needSynPlayersByData=!0},r.prototype.Release=function(){this.battlefield=null,this.boards_root=null,this.boards.Clear(),this.props_root=null,this.props.Clear(),this.players_root=null,this.players.Clear(),this.onHoldings.Clear(),e.prototype.Release.call(this)},r.prototype.Start=function(){var t=this;e.prototype.Start.call(this),this.boards_root=Lib.GameObject.New(Lib.ObjectPool.Instance,!1),this.GameObject.addChild(this.boards_root),this.battlefield.onBoard_Added=function(){t.needSynBoardsByData=!0},this.battlefield.onBoard_Removed=function(){t.needSynBoardsByData=!0},this.props_root=Lib.GameObject.New(Lib.ObjectPool.Instance,!1),this.GameObject.addChild(this.props_root),this.battlefield.onProp_Added=function(){t.needSynPropsByData=!0},this.battlefield.onProp_Removed=function(){t.needSynPropsByData=!0},this.players_root=Lib.GameObject.New(Lib.ObjectPool.Instance,!1),this.GameObject.addChild(this.players_root),this.battlefield.onPlayer_Added=function(){t.needSynPlayersByData=!0},this.battlefield.onPlayer_Removed=function(){t.needSynPlayersByData=!0},this.needSynBoardsByData=!0,this.TrySynBoardsByData(),this.needSynPropsByData=!0,this.TrySynPropsByData(),this.needSynPlayersByData=!0,this.TryRefreshPlayersByData(),this.players.ForEach(function(t,e){e.AiEnabled=!1})},r.prototype.TrySynByData=function(){this.TrySynBoardsByData(),this.TrySynPropsByData(),this.TryRefreshPlayersByData()},r.SynItemsByData=function(t,e,r,n){var a=new Lib.List;e.ForEachKey(function(t){r.ContainsKey(t)||a.Add(t)}),a.ForEach(function(t,r){var n=e.Get(r);n.GameObject.RemoveSelf(),e.Remove(r)}),r.ForEach(function(r,a){if(!e.ContainsKey(r)){var o=n(a);if(null!=o){var i=Lib.GameObject.New(Lib.ObjectPool.Instance);i.components.Add(o),t.addChild(i),e.Set(o.Id,o)}}})},r.prototype.SynBoardsByData=function(){var e=this;r.SynItemsByData(this.boards_root,this.boards,this.battlefield.boards,function(r){if(r instanceof t.BattlefieldBoard)switch(r.Type){case t.BattlefieldBoardTypeEnum.Bubble:return t.StageBattlefieldBoard_Bubble.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldBoardTypeEnum.Conveyor:return t.StageBattlefieldBoard_Conveyor.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldBoardTypeEnum.Ground:return t.StageBattlefieldBoard_Ground.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldBoardTypeEnum.Ice:return t.StageBattlefieldBoard_Ice.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldBoardTypeEnum.Marsh:return t.StageBattlefieldBoard_Marsh.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldBoardTypeEnum.Quicksand:return t.StageBattlefieldBoard_Quicksand.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldBoardTypeEnum.Spring:return t.StageBattlefieldBoard_Spring.New(Lib.ObjectPool.Instance,e,r)}return t.StageBattlefieldBoard_Normal.New(Lib.ObjectPool.Instance,e,r)})},r.prototype.TrySynBoardsByData=function(){this.needSynBoardsByData&&(this.SynBoardsByData(),this.needSynBoardsByData=!1),this.boards.ForEach(function(t,e){e.Update()})},r.prototype.SynPropsByData=function(){var e=this;r.SynItemsByData(this.props_root,this.props,this.battlefield.props,function(r){if(r instanceof t.BattlefieldProp)switch(r.Type){case t.BattlefieldPropTypeEnum.Feather:return t.StageBattlefieldProp_Feather.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldPropTypeEnum.Drinks:return t.StageBattlefieldProp_Drinks.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldPropTypeEnum.Chicken:return t.StageBattlefieldProp_Chicken.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldPropTypeEnum.SpringShoe:return t.StageBattlefieldProp_SpringShoe.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldPropTypeEnum.TurtleShell:return t.StageBattlefieldProp_TurtleShell.New(Lib.ObjectPool.Instance,e,r);case t.BattlefieldPropTypeEnum.TurnBack:return t.StageBattlefieldProp_TurnBack.New(Lib.ObjectPool.Instance,e,r)}return null})},r.prototype.TrySynPropsByData=function(){this.needSynPropsByData&&(this.SynPropsByData(),this.needSynPropsByData=!1),this.props.ForEach(function(t,e){e.Update()})},r.prototype.SynPlayersByData=function(){var e=this;r.SynItemsByData(this.players_root,this.players,this.battlefield.players,function(r){return t.StageBattlefieldPlayer.New(Lib.ObjectPool.Instance,e,r,!1)})},r.prototype.TryRefreshPlayersByData=function(){this.needSynPlayersByData&&(this.SynPlayersByData(),this.needSynPlayersByData=!1),this.players.ForEach(function(t,e){e.Update()})},r.ClassName="StageBattlefield",r}(Lib.GameObjectComponent);t.StageBattlefield=e,__reflect(e.prototype,"DayDayUp.StageBattlefield")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r){var n=null==t?new e:t.Get(e.ClassName,function(){return new e});return n.Init(r),n},e.prototype.Start=function(){t.prototype.Start.call(this),this.stageBattlefield.players.ForEach(function(t,e){e.AiEnabled=!0})},e.prototype.Update=function(){t.prototype.Update.call(this);for(var e=egret.getTimer()/1e3,r=Math.floor((e-this.startTime)*this.stageBattlefield.battlefield.setting.fps);this.stageBattlefield.battlefield.Update(r,this.stageBattlefield.onHoldings)&&!(e-egret.getTimer()/1e3>=.5););this.stageBattlefield.TrySynByData()},e.ClassName="StageBattlefieldController_Ai",e}(t.StageBattlefieldController);t.StageBattlefieldController_Ai=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldController_Ai")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r){var n=null==t?new e:t.Get(e.ClassName,function(){return new e});return n.Init(r),n},e.prototype.Start=function(){var e=this;t.prototype.Start.call(this),this.stageBattlefield.players.ForEach(function(t,r){r.AiEnabled=r.Id!=e.stageBattlefield.battlefield.mainPlayerId}),this.GameObject.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,this),this.GameObject.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.OnTouchEnd,this),this.GameObject.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.OnTouchEnd,this),this.GameObject.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.OnTouchEnd,this)},e.prototype.Release=function(){this.GameObject.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,this),this.GameObject.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.OnTouchEnd,this),this.GameObject.stage.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.OnTouchEnd,this),this.GameObject.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.OnTouchEnd,this),t.prototype.Release.call(this)},e.prototype.Update=function(){t.prototype.Update.call(this);for(var e=egret.getTimer()/1e3,r=Math.floor((e-this.startTime)*this.stageBattlefield.battlefield.setting.fps);this.stageBattlefield.battlefield.Update(r,this.stageBattlefield.onHoldings)&&!(e-egret.getTimer()/1e3>=.5););this.stageBattlefield.TrySynByData()},e.prototype.OnTouchBegin=function(t){this.stageBattlefield.onHoldings.Set(this.stageBattlefield.battlefield.mainPlayerId,!0)},e.prototype.OnTouchEnd=function(t){this.stageBattlefield.onHoldings.Set(this.stageBattlefield.battlefield.mainPlayerId,!1)},e.ClassName="StageBattlefieldController_Manual",e}(t.StageBattlefieldController);t.StageBattlefieldController_Manual=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldController_Manual")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r.record=null,r.playerFrameIndexes=new Lib.Dictionary,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(r),a.record=n,a},e.prototype.Start=function(){var e=this;t.prototype.Start.call(this),this.stageBattlefield.players.ForEach(function(t,r){r.AiEnabled=!1,e.playerFrameIndexes.Set(t,0)})},e.prototype.Update=function(){var e=this;t.prototype.Update.call(this);for(var r=egret.getTimer()/1e3,n=Math.floor((r-this.startTime)*this.stageBattlefield.battlefield.setting.fps);;){if(this.record.players.ForEach(function(t,r){for(var n=e.playerFrameIndexes.Get(t);n<r.frames.Count;n++){var a=r.frames.Get(n);if(a.frameIndex>e.stageBattlefield.battlefield.finishedFrameCount)break;e.playerFrameIndexes.Set(t,n)}e.stageBattlefield.onHoldings.Set(t,r.frames.Get(e.playerFrameIndexes.Get(t)).input)}),!this.stageBattlefield.battlefield.Update(n,this.stageBattlefield.onHoldings))break;if(r-egret.getTimer()/1e3>=.5)break}this.stageBattlefield.TrySynByData()},e.ClassName="StageBattlefieldController_PlayRecord",e}(t.StageBattlefieldController);t.StageBattlefieldController_PlayRecord=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldController_PlayRecord")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e;!function(t){t[t.None=-1]="None",t[t.Asia=0]="Asia",t[t.Australia=1]="Australia",t[t.Europe=2]="Europe",t[t.Antarctica=3]="Antarctica",t[t.NorthAmerica=4]="NorthAmerica",t[t.SouthAmerica=5]="SouthAmerica",t[t.Moon=6]="Moon",t[t.COUNT=7]="COUNT"}(e=t.BattlefieldMapStyle||(t.BattlefieldMapStyle={}));var r=function(){function e(){this.type=t.BattlefieldBoardTypeEnum.Normal,this.startLevel=0,this.startRate=1,this.endLevel=Number.MAX_VALUE,this.endRate=1,this.moveStartLevel=0,this.moveStartRate=0,this.moveStartRate_All=0,this.moveEndLevel=0,this.moveEndRate=0,this.moveEndRate_All=0,this.moveLengthRate_Min=0,this.moveLengthRate_Max=0,this.moveFrameCount_Min=0,this.moveFrameCount_Max=0}return e.prototype.SetMove=function(t,e,r,n,a,o,i,s,l,u){this.moveStartLevel=t,this.moveStartRate=e,this.moveStartRate_All=r,this.moveEndLevel=n,this.moveEndRate=a,this.moveEndRate_All=o,this.moveLengthRate_Min=i,this.moveLengthRate_Max=s,this.moveFrameCount_Min=l,this.moveFrameCount_Max=u},e.prototype.GetRate=function(t){return t<this.startLevel||t>this.endLevel?0:this.endLevel==this.startLevel||this.endRate==this.startRate?this.startRate:this.startRate+(this.endRate-this.startRate)*(t-this.startLevel)/(this.endLevel-this.startLevel)},e.prototype.GetMoveRate=function(t){return t<this.moveStartLevel||t>this.moveEndLevel?0:this.moveEndLevel==this.moveStartLevel||this.moveEndRate==this.moveStartRate?this.moveStartRate:this.moveStartRate+(this.moveEndRate-this.moveStartRate)*(t-this.moveStartLevel)/(this.moveEndLevel-this.moveStartLevel)},e.prototype.GetMoveAllRate=function(t){return t<this.moveStartLevel||t>this.moveEndLevel?0:this.moveEndLevel==this.moveStartLevel||this.moveEndRate_All==this.moveStartRate_All?this.moveStartRate_All:this.moveStartRate_All+(this.moveEndRate_All-this.moveStartRate_All)*(t-this.moveStartLevel)/(this.moveEndLevel-this.moveStartLevel)},e}();t.BattlefieldMapBoardInfo=r,__reflect(r.prototype,"DayDayUp.BattlefieldMapBoardInfo");var n=function(){function t(){}return t.prototype.GetRate=function(t){return t<this.startLevel||t>this.endLevel?0:this.endLevel==this.startLevel||this.endRate==this.startRate?this.startRate:this.startRate+(this.endRate-this.startRate)*(t-this.startLevel)/(this.endLevel-this.startLevel)},t}();t.BattlefieldMapPropInfo=n,__reflect(n.prototype,"DayDayUp.BattlefieldMapPropInfo");var a=function(){function e(t,e,r,n,a,o,i,s,l){this.columCount=4,this.columIndexes=new Array,this.boardInfos=new Lib.List,this.propInfos=new Lib.List,this.style=r,this.columCount=n,this.columWidth=t/this.columCount,this.rowIndexMin=a,this.rowHeight=e/o,this.height=Math.ceil(e*i/this.rowHeight)*this.rowHeight,this.boardWidth_Min=s,this.boardWidth_Max=l;for(var u=1,p=0;p<this.columCount;p++)this.columIndexes.push(u),u+=2,u>=this.columCount&&(u=0)}return e.prototype.GetBoardWidth=function(t){return this.boardWidth_Min+(this.boardWidth_Max-this.boardWidth_Min)*t},Object.defineProperty(e.prototype,"DefaultBoardInfo",{get:function(){return this.boardInfos.Count<=0?null:this.boardInfos.Get(0)},enumerable:!0,configurable:!0}),e.prototype.GetNewBoardInfo=function(t,e){var r=null,n=0,a=new Lib.List;return this.boardInfos.ForEach(function(e,r){var o=r.GetRate(t);a.Add(o),n+=o}),n>1&&(e*=n),this.boardInfos.ForEach(function(t,r){var n=a.Get(t);n>e||(e-=n)},function(){return null!=r}),null==r?this.DefaultBoardInfo:r},e.prototype.CreateBoard=function(e,r,n,a){var o=this.columIndexes[n%this.columCount],i=this.GetNewBoardInfo(a,r.Next(0,1));if(i.type==t.BattlefieldBoardTypeEnum.None)return null;var s,l=this.style+10*n,u=r.Next(0,1)<.5,p=-this.rowHeight*n+this.range.min,d=this.GetBoardWidth(Math.min(-p/this.height,1)),h=1e-4*d;switch(i.type){case t.BattlefieldBoardTypeEnum.Bubble:var c=t.BattlefieldBoard_Bubble.New(e.objectPool,e,l,u,d,h,this.style);s=c;break;case t.BattlefieldBoardTypeEnum.Conveyor:var c=t.BattlefieldBoard_Conveyor.New(e.objectPool,e,l,u,d,h,this.style);s=c;break;case t.BattlefieldBoardTypeEnum.Ice:var c=t.BattlefieldBoard_Ice.New(e.objectPool,e,l,u,d,h,this.style);s=c;break;case t.BattlefieldBoardTypeEnum.Marsh:var c=t.BattlefieldBoard_Marsh.New(e.objectPool,e,l,u,d,h,this.style);s=c;break;case t.BattlefieldBoardTypeEnum.Quicksand:var c=t.BattlefieldBoard_Quicksand.New(e.objectPool,e,l,u,d,h,this.style);s=c;break;case t.BattlefieldBoardTypeEnum.Spring:var c=t.BattlefieldBoard_Spring.New(e.objectPool,e,l,u,d,h,this.style);s=c;break;case t.BattlefieldBoardTypeEnum.Normal:var c=t.BattlefieldBoard_Normal.New(e.objectPool,e,l,u,d,h,this.style);s=c}if(s.SetStartPos((o+.5)*this.columWidth+r.Next(-s.body.width/3,s.body.width/3),p),r.Next(0,1)<i.GetMoveRate(a)){var f=(i.GetMoveAllRate(a),r.Next(0,1)<=i.GetMoveAllRate(a)),y=f,m=f;if(f||(r.Next(0,1)<.5?y=!0:m=!0),y){var g=s.body.width*r.Next(i.moveLengthRate_Min,i.moveLengthRate_Max);f&&(g=2*g/3),s.amplitudeX=r.Next(0,1)<.5?g:-g}if(m){var g=s.body.width*r.Next(i.moveLengthRate_Min,i.moveLengthRate_Max);f&&(g=2*g/3),s.amplitudeY=r.Next(0,1)<.5?g:-g}(y||m)&&(s.amplitudeFrameCount=Math.floor(r.Next(i.moveFrameCount_Min,i.moveFrameCount_Max)))}return s},e.prototype.GetNewPropType=function(e,r){var n=t.BattlefieldPropTypeEnum.None,a=0,o=new Lib.List;return this.propInfos.ForEach(function(t,r){var n=r.GetRate(e);o.Add(n),a+=n}),a>1&&(r*=a),this.propInfos.ForEach(function(t,e){var a=o.Get(t);a>r?n!=e.type:r-=a},function(){return n!=t.BattlefieldPropTypeEnum.None}),n},e.prototype.CreateProp=function(e,r,n,a){var o,i=this.GetNewPropType(a,r.Next(0,1));switch(i){case t.BattlefieldPropTypeEnum.Feather:var s=t.BattlefieldProp_Feather.New(e.objectPool,e,n,n);o=s;break;case t.BattlefieldPropTypeEnum.Drinks:var s=t.BattlefieldProp_Drinks.New(e.objectPool,e,n,n);o=s;break;case t.BattlefieldPropTypeEnum.Chicken:var s=t.BattlefieldProp_Chicken.New(e.objectPool,e,n,n);o=s;break;case t.BattlefieldPropTypeEnum.SpringShoe:var s=t.BattlefieldProp_SpringShoe.New(e.objectPool,e,n,n);o=s;break;case t.BattlefieldPropTypeEnum.TurtleShell:var s=t.BattlefieldProp_TurtleShell.New(e.objectPool,e,n,n);o=s;break;case t.BattlefieldPropTypeEnum.TurnBack:var s=t.BattlefieldProp_TurnBack.New(e.objectPool,e,n,n);o=s;break;default:o=null}return o},e.prototype.RefreshBoards=function(t,e,r,n,a,o){for(var i=Math.max(this.rowIndexMin,e),s=Math.ceil(-r/this.rowHeight),l=i;s>l;l++){var u=l*this.rowHeight;if(u>=this.height)break;var p=t.random_main;p.SetSeed(this.style+10*l+1e4*t.setting.seed);var d=Math.floor(u/t.setting.showHeight),h=this.CreateBoard(t,p,l,d);if(null!=h){null!=n&&n(h);var c=this.CreateProp(t,p,h.id,d);null!=c&&null!=a&&a(c)}null!=o&&o(l)}},e}();t.BattlefieldMap=a,__reflect(a.prototype,"DayDayUp.BattlefieldMap");var o=function(){function n(t,n){this.maps=new Lib.List;var o=new a(t,n,e.Australia,5,3,17,2,t/4,t/4),i=new r;i.SetMove(2,.3,.3,2,.3,.3,.25,.5,15,20),o.boardInfos.Add(i),this.maps.Add(o);var o=new a(t,n,e.Europe,5,0,17,2,t/4,t/4*.9),i=new r;i.SetMove(0,.3,.3,2,.3,.3,.25,.5,15,25),o.boardInfos.Add(i),this.maps.Add(o);var o=new a(t,n,e.Asia,4,0,17,Number.MAX_VALUE,t/4*.9,t/4*.9),i=new r;i.SetMove(0,1,.5,Number.MAX_VALUE,1,.5,.4,.6,15,30),o.boardInfos.Add(i),this.maps.Add(o);var s=0;this.maps.ForEach(function(t,e){var r=s-e.height;e.range=new Lib.Range(s,r),s=r})}return n.prototype.GetMapIndexByPos=function(t){var e=-1;return this.maps.ForEach(function(r,n){t<=n.range.min&&t>n.range.max&&(e=r)},function(){return e>=0}),0>e&&(e=this.maps.Count-1),e},n.prototype.GetBoardType=function(e,r){return t.BattlefieldBoardTypeEnum.None},n.prototype.GetPropType=function(e,r){return t.BattlefieldPropTypeEnum.None},n.prototype.RefreshBoards=function(t,e,r,n,a,o,i){for(var s=e,l=r;;){var u=this.maps.Get(s);if(u.RefreshBoards(t,l,n-u.range.min,a,o,function(t){null!=i&&i(s,t)}),n>u.range.max)break;s++,l=0}},n}();t.BattlefieldMapManager=o,__reflect(o.prototype,"DayDayUp.BattlefieldMapManager")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(){function e(){this.fps=60,this.seed=egret.getTimer(),this.showWidth=9,this.showHeight=16,this.hp=1,this.superForcePerMaxJump=1,this.superForceMax=6,this.jumpPowerPerFrame=1,this.jumpPowerMax=30,this.jumpPowerAtMaxFrameCount=60,this.g=.01,this.airSpeed=.03,this.runSpeed=.03,this.jumpSpeedMax=-Math.sqrt(.4*this.showHeight*(2*this.g)),this.jumpSpeedMin=.25*this.jumpSpeedMax,this.superJumpSpeed=5*this.jumpSpeedMax,this.propFrameCounts=new Lib.Dictionary,this.prop_SuperForce_Chicken=this.superForceMax/2,this.propRate_G_Feather=.75,this.propRate_SpeedX_TurtleShell=.75,this.propRate_JumpPowerPerFrame_Drinks=2,this.propRate_JumpSpeed_SpringShoe=1.5,this.propRate_SuperJumpSpeed_SpringShoe=1.25,this.lifeFrameCount_Quicksand=60,this.elapseLifePerFrame_Quicksand=1,this.groundOffsetMax_Marsh=.8,this.groundOffsetPerFrame_Marsh=this.groundOffsetMax_Marsh/50,this.propFrameCounts.Set(t.BattlefieldPropTypeEnum.Feather,5*this.fps),this.propFrameCounts.Set(t.BattlefieldPropTypeEnum.Drinks,5*this.fps),this.propFrameCounts.Set(t.BattlefieldPropTypeEnum.SpringShoe,5*this.fps),this.propFrameCounts.Set(t.BattlefieldPropTypeEnum.TurtleShell,5*this.fps)}return e}();t.BattlefieldSetting=e,__reflect(e.prototype,"DayDayUp.BattlefieldSetting")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Bubble",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("116_png");r.texture=n,r.x=e.x,r.y=e.y,r.width=e.width,r.height=n.textureHeight*e.width/n.textureWidth,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldBoard_Bubble",e}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Bubble=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Bubble")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Conveyor",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 16776960},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("101_png");r.texture=n,r.x=e.x,r.y=e.y,r.width=e.width,r.height=n.textureHeight*e.width/n.textureWidth,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldBoard_Conveyor",e}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Conveyor=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Conveyor")}(DayDayUp||(DayDayUp={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var DebugWx=function(){function t(){}return t.prototype.getBatteryInfoSync=function(){return"{level: 99}"},t}();__reflect(DebugWx.prototype,"DebugWx",["wx"]),window.wx||(window.wx=new DebugWx);var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Ice",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 16777215},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("132_png");r.texture=n,r.x=e.x,r.y=e.y,r.width=e.width,r.height=n.textureHeight*e.width/n.textureWidth,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldBoard_Ice",e}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Ice=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Ice")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Marsh",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("89_png");r.texture=n,r.x=e.x,r.y=e.y,r.width=e.width,r.height=n.textureHeight*e.width/n.textureWidth,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldBoard_Marsh",e}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Marsh=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Marsh")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),r.New=function(t,e,n){var a=null==t?new r:t.Get(r.ClassName,function(){return new r});return a.Init(t,e,n),a},Object.defineProperty(r.prototype,"Normal",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"BodyColor",{get:function(){return 0},enumerable:!0,configurable:!0}),r.prototype.Start=function(){e.prototype.Start.call(this);var r,n=this.GetBodyRect(),a=new egret.Bitmap;switch(this.Normal.style){case t.BattlefieldMapStyle.Asia:r=RES.getRes("144_png");break;case t.BattlefieldMapStyle.Australia:r=RES.getRes("109_png");break;default:r=RES.getRes("78_png")}a.texture=r,a.x=n.x,a.y=n.y,a.width=n.width,a.height=r.textureHeight*n.width/r.textureWidth,this.rootGameObject.addChild(a)},r.ClassName="StageBattlefieldBoard_Normal",r}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Normal=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Normal")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Quicksand",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 16711935},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("103_png");r.texture=n,r.x=e.x,r.y=e.y,r.width=e.width,r.height=n.textureHeight*e.width/n.textureWidth,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldBoard_Quicksand",e}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Quicksand=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Quicksand")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Spring",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 65535},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("128_png");r.texture=n,r.x=e.x,r.y=e.y,r.width=e.width,r.height=n.textureHeight*e.width/n.textureWidth,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldBoard_Spring",e}(t.StageBattlefieldBoard);t.StageBattlefieldBoard_Spring=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldBoard_Spring")}(DayDayUp||(DayDayUp={}));var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.OnInited=function(){t.prototype.OnInited.call(this),this.ChangeTo(new DayDayUp.SubScreenMain)},e}(Lib.UIManager);__reflect(Main.prototype,"Main");var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t.ai=null,t}return __extends(r,e),Object.defineProperty(r.prototype,"Player",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"BodyColor",{get:function(){return 65280},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"AiEnabled",{set:function(e){e?null==this.ai&&(this.ai=t.StageBattlefieldPlayerAI.New(this.pool,this)):null!=this.ai&&(this.ai.Release(),this.ai=null)},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Player(t,e,n,a),o},r.prototype.Init_Player=function(t,r,n,a){e.prototype.Init.call(this,t,r,n),this.AiEnabled=a},r.prototype.Release=function(){this.AiEnabled=!1,this.result=null,e.prototype.Release.call(this)},r.prototype.Start=function(){e.prototype.Start.call(this);
var t=this.GetBodyRect();this.result=new egret.Bitmap;var r=RES.getRes("164_png");this.result.texture=r,this.result.width=2*t.width,this.result.height=r.textureHeight*t.width/r.textureWidth*2,this.result.x=-this.result.width/2,this.result.y=-this.result.height,this.rootGameObject.addChild(this.result)},r.prototype.Update=function(){e.prototype.Update.call(this),null!=this.ai&&this.ai.Ai();var r=this.ownerStageBattlefield.boards.Get(this.Player.AtBoardId);this.Player.state!=this.playerLastState&&this.Player.state==t.BattlefieldPlayerStateEnum.Run&&(r.WhenTrampled(this),null!=this.ai&&this.ai.Refresh()),null!=r?this.SetShowOffset(r.ShowOffsetX,r.ShowOffsetY):this.SetShowOffset(0,0),this.result.alpha=this.Player.curSuperForce>=this.Player.SuperForceMax?.5:1,this.playerLastState=this.Player.state},r.ClassName="StageBattlefieldPlayer",r}(t.StageBattlefieldItem);t.StageBattlefieldPlayer=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldPlayer")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r.random=new Lib.HLRandom(egret.getTimer()),r}return __extends(e,t),e.New=function(t,r){var n=null==t?new e:t.Get(e.ClassName,function(){return new e});return n.Init(r),n},e.prototype.Init=function(t){this.player=t,this.edgeOffset=0,this.maxDelay=0},e.prototype.Release=function(){this.player=null,t.prototype.Release.call(this)},e.prototype.Ai=function(){var t=this.player.ownerStageBattlefield.boards.Get(this.player.Player.AtBoardId),e=!0;this.player.Player.curJumpPower>=this.player.Player.JumpPowerMax&&this.player.Player.curJumpPowerAtMaxFrameCount>=this.maxDelay?e=!1:null!=t&&this.player.Player.AtEdge(this.edgeOffset)&&(e=!1),this.player.ownerStageBattlefield.onHoldings.Set(this.player.Id,e)},e.prototype.Refresh=function(){this.maxDelay=this.random.Next(0,.2*this.player.Player.JumpPowerAtMaxFrameCount),this.edgeOffset=this.random.Next(0,.2*this.player.Player.body.width)},e.ClassName="StageBattlefieldPlayerAI",e}(Lib.PoolableObj);t.StageBattlefieldPlayerAI=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldPlayerAI")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Chicken",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("9_png");r.texture=n,r.width=n.textureWidth*this.Scale,r.height=n.textureHeight*this.Scale,r.x=e.x+(e.width-r.width)/2,r.y=e.y+(e.height-r.height)/2,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldProp_Chicken",e}(t.StageBattlefieldProp);t.StageBattlefieldProp_Chicken=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldProp_Chicken")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Drinks",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("4_png");r.texture=n,r.width=n.textureWidth*this.Scale,r.height=n.textureHeight*this.Scale,r.x=e.x+(e.width-r.width)/2,r.y=e.y+(e.height-r.height)/2,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldProp_Drinks",e}(t.StageBattlefieldProp);t.StageBattlefieldProp_Drinks=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldProp_Drinks")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"Feather",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("3_png");r.texture=n,r.width=n.textureWidth*this.Scale,r.height=n.textureHeight*this.Scale,r.x=e.x+(e.width-r.width)/2,r.y=e.y+(e.height-r.height)/2,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldProp_Feather",e}(t.StageBattlefieldProp);t.StageBattlefieldProp_Feather=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldProp_Feather")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"SpringShoe",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("11_png");r.texture=n,r.width=n.textureWidth*this.Scale,r.height=n.textureHeight*this.Scale,r.x=e.x+(e.width-r.width)/2,r.y=e.y+(e.height-r.height)/2,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldProp_SpringShoe",e}(t.StageBattlefieldProp);t.StageBattlefieldProp_SpringShoe=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldProp_SpringShoe")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"TurnBack",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("13_png");r.texture=n,r.width=n.textureWidth*this.Scale,r.height=n.textureHeight*this.Scale,r.x=e.x+(e.width-r.width)/2,r.y=e.y+(e.height-r.height)/2,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldProp_TurnBack",e}(t.StageBattlefieldProp);t.StageBattlefieldProp_TurnBack=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldProp_TurnBack")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n){var a=null==t?new e:t.Get(e.ClassName,function(){return new e});return a.Init(t,r,n),a},Object.defineProperty(e.prototype,"TurtleShell",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BodyColor",{get:function(){return 255},enumerable:!0,configurable:!0}),e.prototype.Start=function(){t.prototype.Start.call(this);var e=this.GetBodyRect(),r=new egret.Bitmap,n=RES.getRes("12_png");r.texture=n,r.width=n.textureWidth*this.Scale,r.height=n.textureHeight*this.Scale,r.x=e.x+(e.width-r.width)/2,r.y=e.y+(e.height-r.height)/2,this.rootGameObject.addChild(r)},e.ClassName="StageBattlefieldProp_TurtleShell",e}(t.StageBattlefieldProp);t.StageBattlefieldProp_TurtleShell=e,__reflect(e.prototype,"DayDayUp.StageBattlefieldProp_TurtleShell")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Bubble},enumerable:!0,configurable:!0}),r.prototype.GetPlayerRunSpeedRate=function(){return.95},r.prototype.GetPlayerJumpSpeedRate=function(){return 1.5},r.prototype.GetPlayerSuperJumpSpeedRate=function(){return 1.5},r.New=function(t,e,n,a,o,i,s){var l=null==t?new r:t.Get(r.ClassName,function(){return new r});return l.Init_Board(e,n,a,o,i,s),l},r.ClassName="BattlefieldBoard_Bubble",r}(t.BattlefieldBoard);t.BattlefieldBoard_Bubble=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Bubble")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),Object.defineProperty(r.prototype,"ClassName",{get:function(){return"SubScreenBattlefield_Solo_PlayRecord"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"BGMFilePath",{get:function(){return"resource/Sound/BGM/BGM_Battlefield.wav"},enumerable:!0,configurable:!0}),r.prototype.GetResGroupNames=function(){var t=new Lib.List;return t.Add("Battlefield"),t},r.prototype.Start=function(){var e=this,n=new t.RoomController_SoloUI("DayDayUp",t.RoomController_Solo.ClassName,null);this.DisplayRoot.addChild(n);var a=new t.BattlefieldSetting;a.seed=r.lastRecord.seed;var o=new t.Battlefield(a);this.roomController=t.RoomController_Solo_PlayRecord.NewWithGameObject(this.owner.stage.stageWidth,this.owner.stage.stageHeight,o,n),this.roomController.onEnd=function(){e.owner.ChangeTo(new t.SubScreenMain)},this.DisplayRoot.addChildAt(this.roomController.GameObject,0)},r.lastRecord=null,r}(Lib.SubScreen);t.SubScreenBattlefield_Solo_PlayRecord=e,__reflect(e.prototype,"DayDayUp.SubScreenBattlefield_Solo_PlayRecord")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),Object.defineProperty(r.prototype,"ClassName",{get:function(){return"SubScreenBattlefield_Solo"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"BGMFilePath",{get:function(){return"resource/Sound/BGM/BGM_Battlefield.wav"},enumerable:!0,configurable:!0}),r.prototype.GetResGroupNames=function(){var t=new Lib.List;return t.Add("Battlefield"),t},r.prototype.Start=function(){var e=this,r=new t.RoomController_SoloUI("DayDayUp",t.RoomController_Solo.ClassName,null);this.DisplayRoot.addChild(r);var n=new t.Battlefield(new t.BattlefieldSetting);this.roomController=t.RoomController_Solo.NewWithGameObject(this.owner.stage.stageWidth,this.owner.stage.stageHeight,n,r),this.roomController.onEnd=function(){e.owner.ChangeTo(new t.SubScreenMain)},this.DisplayRoot.addChildAt(this.roomController.GameObject,0)},r}(Lib.SubScreen);t.SubScreenBattlefield_Solo=e,__reflect(e.prototype,"DayDayUp.SubScreenBattlefield_Solo")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.roomController=null,t}return __extends(r,e),Object.defineProperty(r.prototype,"ClassName",{get:function(){return"SubScreenMain"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"BGMFilePath",{get:function(){return"resource/Sound/BGM/BGM_Main.wav"},enumerable:!0,configurable:!0}),r.prototype.GetResGroupNames=function(){var t=new Lib.List;return t.Add("preload"),t.Add("Battlefield"),t},r.prototype.Start=function(){var e=this,r=t.LocalSetting_DayDayUp.Instance.PlayCount;this.ui=new t.SubScreenMainUI("DayDayUp",this.ClassName,function(){e.ui.button_FirstStart.addEventListener(egret.TouchEvent.TOUCH_TAP,e.OnButtonClicked_Start,e),e.ui.button_Start.addEventListener(egret.TouchEvent.TOUCH_TAP,e.OnButtonClicked_Start,e)}),this.ui.group_First.visible=0>=r,this.ui.group_Main.visible=r>0,this.DisplayRoot.addChild(this.ui),this.CreatRoomController()},r.prototype.CreatRoomController=function(){var e=this;this.roomController=t.RoomController_Demo.NewWithGameObject(this.owner.stage.stageWidth,this.owner.stage.stageHeight),this.DisplayRoot.addChildAt(this.roomController.GameObject,0),this.roomController.onEnd=function(){e.roomController.GameObject.RemoveSelf(),e.CreatRoomController()}},r.prototype.OnButtonClicked_Start=function(){var e=this;Lib.MessageBox.ShowYesNo(null,"测试","开始游戏",function(){e.owner.ChangeTo(new t.SubScreenBattlefield_Solo),t.LocalSetting_DayDayUp.Instance.PlayCount++})},r.prototype.OnButtonClicked_Start0=function(){null==t.SubScreenBattlefield_Solo_PlayRecord.lastRecord?this.owner.ChangeTo(new t.SubScreenBattlefield_Solo):this.owner.ChangeTo(new t.SubScreenBattlefield_Solo_PlayRecord)},r}(Lib.SubScreen);t.SubScreenMain=e,__reflect(e.prototype,"DayDayUp.SubScreenMain")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Lib.UI);t.SubScreenMainUI=e,__reflect(e.prototype,"DayDayUp.SubScreenMainUI")}(DayDayUp||(DayDayUp={}));var Match3;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Lib.UI);t.MainMenuUI=e,__reflect(e.prototype,"Match3.MainMenuUI")}(Match3||(Match3={}));var Lib;!function(t){var e=function(){function t(t){this.SetSeed(t)}return t.prototype.SetSeed=function(t){this.seed=t},t.prototype.Next=function(t,e){e=e||1,t=t||0,this.seed=(9301*this.seed+49297)%233280;var r=this.seed/233280;return t+r*(e-t)},t.prototype.NextWithSeed=function(t,e,r){return this.seed=t,this.Next(e,r)},t}();t.HLRandom=e,__reflect(e.prototype,"Lib.HLRandom")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Conveyor},enumerable:!0,configurable:!0}),r.prototype.GetGroundSpeed=function(){return.5*this.ownerBattlefield.setting.runSpeed*(this.faceToRight?1:-1)},r.New=function(t,e,n,a,o,i,s){var l=null==t?new r:t.Get(r.ClassName,function(){return new r});return l.Init_Board(e,n,a,o,i,s),l},r.ClassName="BattlefieldBoard_Conveyor",r}(t.BattlefieldBoard);t.BattlefieldBoard_Conveyor=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Conveyor")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t.instance},enumerable:!0,configurable:!0}),t.GetNumber=function(t,e){var r=parseInt(egret.localStorage.getItem(t),10);return isNaN(r)?e:r},Object.defineProperty(t.prototype,"BGMVolume",{get:function(){return isNaN(this.bgmVolume)&&(this.bgmVolume=t.GetNumber("BGMVolume",.5)),this.bgmVolume},set:function(t){egret.localStorage.setItem("BGMVolume",t.toString()),this.bgmVolume=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SFXVolume",{get:function(){return isNaN(this.sfxVolume)&&(this.sfxVolume=t.GetNumber("SFXVolume",.8)),this.sfxVolume},set:function(t){egret.localStorage.setItem("SFXVolume",t.toString()),this.sfxVolume=t},enumerable:!0,configurable:!0}),t.instance=new t,t}();t.LocalSetting_System=e,__reflect(e.prototype,"Lib.LocalSetting_System")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Ground},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a){var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init_Board_Ground(e,n,a),o},r.prototype.Init_Board_Ground=function(r,n,a){e.prototype.Init_Board.call(this,r,n,a,r.setting.showWidth,.6,t.BattlefieldMapStyle.None)},r.ClassName="BattlefieldBoard_Ground",r}(t.BattlefieldBoard);t.BattlefieldBoard_Ground=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Ground")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(){function t(t,e){this.min=t,this.max=e}return t}();t.Range=e,__reflect(e.prototype,"Lib.Range")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Ice},enumerable:!0,configurable:!0}),r.prototype.GetPlayerRunSpeedRate=function(){return 1.5},r.New=function(t,e,n,a,o,i,s){var l=null==t?new r:t.Get(r.ClassName,function(){return new r});return l.Init_Board(e,n,a,o,i,s),l},r.ClassName="BattlefieldBoard_Ice",r}(t.BattlefieldBoard);t.BattlefieldBoard_Ice=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Ice")}(DayDayUp||(DayDayUp={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Marsh},enumerable:!0,configurable:!0}),r.prototype.GetGroundOffsetMax=function(){return this.ownerBattlefield.setting.groundOffsetMax_Marsh},r.prototype.GetGroundOffsetPerFrame=function(){return this.ownerBattlefield.setting.groundOffsetPerFrame_Marsh},r.prototype.GetPlayerRunSpeedRate=function(){return.9},r.prototype.GetPlayerJumpSpeedRate=function(){return.9},r.prototype.GetPlayerSuperJumpSpeedRate=function(){return.9},r.New=function(t,e,n,a,o,i,s){var l=null==t?new r:t.Get(r.ClassName,function(){return new r});return l.Init_Board(e,n,a,o,i,s),l},r.ClassName="BattlefieldBoard_Marsh",r}(t.BattlefieldBoard);t.BattlefieldBoard_Marsh=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Marsh")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(e){function r(){var n=null!==e&&e.apply(this,arguments)||this;return n.className=r.ClassName,n.commands=new t.List,n}return __extends(r,e),Object.defineProperty(r.prototype,"Count",{get:function(){return this.commands.Count},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a){null!=e&&(e.Release(),e=null);var o=null==t?new r:t.Get(r.ClassName,function(){return new r});return o.Init(n,a),o},r.prototype.Release=function(){this.Clear(),e.prototype.Release.call(this)},r.prototype.Add=function(e,r){if(void 0===r&&(r=!1),r)for(var n=this.commands.Count-1;n>=0;n--)e.className==this.commands.Get(n).className&&t.Command.Commands_RemoveAt(this.commands,n);return this.commands.Add(e),e},r.prototype.Clear=function(){t.Command.Commands_Clear(this.commands)},r.prototype.Update=function(){e.prototype.Update.call(this);for(var r=0;r<this.commands.Count;r++)this.commands.Get(r).Update();for(var r=this.commands.Count-1;r>=0;r--)this.commands.Get(r).removed&&t.Command.Commands_RemoveAt(this.commands,r);this.commands.Count<=0&&this.End()},r.prototype.ClearTypeOf=function(e){for(var r=!1,n=this.commands.Count-1;n>=0;n--)e==this.commands.Get(n).className&&(t.Command.Commands_RemoveAt(this.commands,n),r=!0);return r},r.prototype.ContainsTypeOf=function(t){for(var e=0;e<this.commands.Count;e++)if(t==this.commands.Get(e).className)return!0;return!1},r.prototype.ContainsTypesOf=function(t){for(var e=0;e<this.commands.Count;e++)if(t.Contains(this.commands.Get(e).className))return!0;return!1},r.ClassName="Command_Commands",r}(t.Command);t.Command_Commands=e,__reflect(e.prototype,"Lib.Command_Commands")}(Lib||(Lib={}));var Lib;!function(t){var e=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.className=e.ClassName,r}return __extends(e,t),e.New=function(t,r,n,a,o,i,s,l,u,p){var d=null==t?new e:t.Get(e.ClassName,function(){return new e});return d.Init_GameObjectPosition(r,n,a,o,i,s,l,u,p),d},e.prototype.Init_GameObjectPosition=function(e,r,n,a,o,i,s,l,u){t.prototype.Init.call(this,l,u),this.gameObject=e,this.startX=r,this.startY=n,this.endX=a,this.endY=o,this.lifeTime=i,this.mi=s,e.x=r,e.y=n},e.prototype.Update=function(){if(t.prototype.Update.call(this),null==this.gameObject)return void this.End();var e=this.DeltaTime;if(e<this.lifeTime){var r=Math.pow(e/this.lifeTime,this.mi);this.gameObject.x=this.startX+(this.endX-this.startX)*r,this.gameObject.y=this.startY+(this.endY-this.startY)*r}else this.gameObject.x=this.endX,this.gameObject.y=this.endY,this.End()},e.prototype.Release=function(){this.gameObject=null,t.prototype.Release.call(this)},e.ClassName="Command_LocalPosition",e}(t.Command);t.Command_LocalPosition=e,__reflect(e.prototype,"Lib.Command_LocalPosition")}(Lib||(Lib={}));var Lib;!function(t){var e=function(e){function r(){var n=null!==e&&e.apply(this,arguments)||this;return n.className=r.ClassName,n.steps=new t.List,n}return __extends(r,e),Object.defineProperty(r.prototype,"Count",{get:function(){return this.steps.Count},enumerable:!0,configurable:!0}),r.New=function(t,e,n){var a=null==t?new r:t.Get(r.ClassName,function(){return new r});return a.Init(e,n),a},r.prototype.Release=function(){this.Clear(),e.prototype.Release.call(this)},r.prototype.Add=function(t){return this.steps.Add(t),t},r.prototype.Clear=function(){t.Command.Commands_Clear(this.steps)},r.prototype.Update=function(){if(e.prototype.Update.call(this),this.steps.Count>0){var r=this.steps.Get(0);r.Update(),r.removed&&t.Command.Commands_RemoveAt(this.steps,0)}this.steps.Count<=0&&this.End()},r.ClassName="Command_Steps",r}(t.Command);t.Command_Steps=e,__reflect(e.prototype,"Lib.Command_Steps")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Normal},enumerable:!0,configurable:!0}),r.New=function(t,e,n,a,o,i,s){var l=null==t?new r:t.Get(r.ClassName,function(){return new r});return l.Init_Board(e,n,a,o,i,s),l},r.ClassName="BattlefieldBoard_Normal",r}(t.BattlefieldBoard);t.BattlefieldBoard_Normal=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Normal")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t.components=null,t}return __extends(r,e),Object.defineProperty(r.prototype,"Inited",{get:function(){return this._inited},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ParentGameObject",{get:function(){return this.parent},enumerable:!0,configurable:!0}),r.New=function(t,e){void 0===e&&(e=!0);var n=null==t?new r:t.Get(r.ClassName,function(){return new r});return n.Init(e),n},r.prototype.Init=function(e){void 0===e&&(e=!0),this._inited=!1,this.enabled=e,this.components=t.GameObjectComponentManager.New(this.pool,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.OnConfigComplete,this)},r.prototype.Release=function(){return this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.Release,this),this.enabled=!1,null!=this.components&&(this.components.Release(),this.components=null),this.removeChildren(),null==this.pool?void console.info("重复Release"):(this.pool.Free(this),void(this.pool=null))},r.prototype.OnConfigComplete=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.OnConfigComplete,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.Release,this),this._inited=!0,this.Ready(),this.enabled&&this.addEventListener(egret.Event.ENTER_FRAME,this.Update,this)},r.prototype.RemoveSelf=function(){null!=this.parent&&this.parent.removeChild(this)},r.prototype.Ready=function(){this.components.Start()},r.prototype.Update=function(){null!=this.components&&this.components.Update()},r.ClassName="GameObject",r}(GameObjectBase);t.GameObject=e,__reflect(e.prototype,"Lib.GameObject",["Lib.IPoolableObj"])}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Quicksand},enumerable:!0,configurable:!0}),r.prototype.GetPlayerRunSpeedRate=function(){return.95},r.prototype.GetPlayerJumpSpeedRate=function(){return.95},r.prototype.GetPlayerSuperJumpSpeedRate=function(){return.95},r.New=function(t,e,n,a,o,i,s){var l=null==t?new r:t.Get(r.ClassName,function(){return new r});return l.Init_Board_Quicksand(e,n,a,o,i,s),l},r.prototype.Init_Board_Quicksand=function(t,r,n,a,o,i){e.prototype.Init_Board.call(this,t,r,n,a,o,i),this.leftLifeFrameCount=this.ownerBattlefield.setting.lifeFrameCount_Quicksand},r.prototype.Update=function(){var t=this;e.prototype.Update.call(this),this.ownerBattlefield.players.ForEach(function(e,r){t.needRemoved||r.AtBoardId!=t.id||(t.leftLifeFrameCount<=0?t.needRemoved=!0:t.leftLifeFrameCount-=r.ElapseLifePerFrame_Quicksand)})},r.ClassName="BattlefieldBoard_Quicksand",r}(t.BattlefieldBoard);t.BattlefieldBoard_Quicksand=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Quicksand")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(e){function r(){var n=null!==e&&e.apply(this,arguments)||this;return n.className=r.ClassName,n.components=new t.List,n}return __extends(r,e),r.New=function(t,e){var n=null==t?new r:t.Get(r.ClassName,function(){return new r});return n.Init(e),n},r.prototype.Init=function(t){this.gameObject=t},r.prototype.Release=function(){this.components.ForEach(function(t,e){e.Release()}),this.components.Clear(),this.gameObject=null,e.prototype.Release.call(this)},r.prototype.Get=function(t){return this.components.ForEach(function(e,r){return typeof r==t?r:void 0}),null},r.prototype.Add=function(t){return t.ownerComponentManager=this,this.components.Add(t),t},r.prototype.Remove=function(t){var e=this;this.components.ForEachInverted(function(r,n){typeof n==t&&(n.Release(),e.components.RemoveAt(r))})},r.prototype.Clear=function(){var t=this;this.components.ForEachInverted(function(e,r){r.Release(),t.components.RemoveAt(e)})},r.prototype.Start=function(){this.components.ForEach(function(t,e){e.Start()})},r.prototype.Update=function(){this.components.ForEach(function(t,e){e.enabled&&e.Update()})},r.ClassName="GameObjectComponentManager",r}(t.PoolableObj);t.GameObjectComponentManager=e,__reflect(e.prototype,"Lib.GameObjectComponentManager")}(Lib||(Lib={}));var Lib;!function(t){var e;!function(t){t[t.Normal=0]="Normal",t[t.Loading=1]="Loading",t[t.Playing=2]="Playing"}(e=t.SoundStateEnum||(t.SoundStateEnum={}));var r=function(){function t(t){this.sound=null,this.channel=null,this.state=e.Normal,this.owner=t}return t.prototype.Play=function(t,r,n){this.sound=this.owner.PopSound(),this.name=t,this.volume=r,this.loopCount=n,this.state=e.Loading,this.sound.addEventListener(egret.Event.COMPLETE,this.LoadOver,this),this.sound.addEventListener(egret.IOErrorEvent.IO_ERROR,this.LoadError,this),this.sound.load(t)},t.prototype.LoadOver=function(){this.sound.removeEventListener(egret.Event.COMPLETE,this.LoadOver,this),this.sound.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.LoadError,this),this.state=e.Playing,this.channel=this.sound.play(0,this.loopCount),this.channel.volume=this.volume,this.channel.addEventListener(egret.Event.SOUND_COMPLETE,this.PlayOver,this)},t.prototype.LoadError=function(){this.sound.removeEventListener(egret.Event.COMPLETE,this.LoadOver,this),this.sound.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.LoadError,this),this.End(),console.log("播放声音失败: "+this.name)},t.prototype.PlayOver=function(){this.channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.PlayOver,this),this.End()},t.prototype.Stop=function(){null!=this.channel&&this.channel.stop(),this.End()},t.prototype.End=function(){this.state=e.Normal,this.owner.PushSound(this.sound),this.sound=null,this.channel=null},t}();t.SoundInfo=r,__reflect(r.prototype,"Lib.SoundInfo")}(Lib||(Lib={}));var Lib;!function(t){var e=function(){function e(){this.sounds=new t.List,this.soundInfoGroups=new t.Dictionary}return Object.defineProperty(e,"Instance",{get:function(){return e.instance},enumerable:!0,configurable:!0}),e.prototype.PopSound=function(){return this.sounds.Count>0?this.sounds.Get(this.sounds.Count-1):new egret.Sound},e.prototype.PushSound=function(t){this.sounds.Add(t)},e.prototype.PlaySFX=function(e,r,n){if(void 0===r&&(r=1),void 0===n&&(n=1),r*=t.LocalSetting_System.Instance.SFXVolume,!(0>=r)){var a=this.GetSoundInfo_New(e);a.Play(e,r,n)}},e.prototype.PlayBGM=function(e,r,n){if(void 0===r&&(r=1),void 0===n&&(n=-1),r*=t.LocalSetting_System.Instance.BGMVolume,!(0>=r)){var a=this.GetSoundInfo_New(e);a.Play(e,r,n)}},e.prototype.StopBGM=function(t){var e=this.GetSoundInfo_Playing(t);null!=e&&e.Stop()},e.prototype.GetSoundInfo_Playing=function(e){if(!this.soundInfoGroups.ContainsKey(e))return null;var r=this.soundInfoGroups.Get(e),n=null;return r.ForEach(function(e,r){r.state!=t.SoundStateEnum.Normal&&(n=r)},function(){return null!=n}),n},e.prototype.GetSoundInfo_New=function(e){var r=null;this.soundInfoGroups.ContainsKey(e)?r=this.soundInfoGroups.Get(e):(r=new t.List,this.soundInfoGroups.Set(e,r));var n=null;return r.ForEach(function(e,r){r.state==t.SoundStateEnum.Normal&&(n=r)},function(){return null!=n}),null==n&&(n=new t.SoundInfo(this),r.Add(n)),n},e.instance=new e,e}();t.SoundManager=e,__reflect(e.prototype,"Lib.SoundManager")}(Lib||(Lib={}));var DayDayUp;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.className=r.ClassName,t}return __extends(r,e),Object.defineProperty(r.prototype,"Type",{get:function(){return t.BattlefieldBoardTypeEnum.Spring},enumerable:!0,configurable:!0}),r.prototype.GetPlayerJumpSpeedRate=function(){return 2},r.prototype.GetPlayerSuperJumpSpeedRate=function(){return 2},r.New=function(t,e,n,a,o,i,s){var l=null==t?new r:t.Get(r.ClassName,function(){return new r});return l.Init_Board(e,n,a,o,i,s),l},r.ClassName="BattlefieldBoard_Spring",r}(t.BattlefieldBoard);t.BattlefieldBoard_Spring=e,__reflect(e.prototype,"DayDayUp.BattlefieldBoard_Spring")}(DayDayUp||(DayDayUp={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function n(n){e.call(r,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Lib;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.buttonReleased=function(){e.prototype.buttonReleased.call(this),t.SoundManager.Instance.PlaySFX("resource/Sound/UI/SFX_Button_Clicked.wav")},r}(eui.Button);t.Button=e,__reflect(e.prototype,"Lib.Button")}(Lib||(Lib={}));var Lib;!function(t){var e;!function(t){t[t.YesNo=0]="YesNo",t[t.OK=1]="OK"}(e=t.MessageBoxModeEnum||(t.MessageBoxModeEnum={}));var r=function(r){function n(t,e,n,a,o){var i=r.call(this,"",null!=t&&t.length>0?t:"MessageBox",e)||this;return i.label_Title.text=n,i.label_Message.text=a,i.button_Yes.visible=!1,i.button_No.visible=!1,i.button_Ok.visible=!1,i}return __extends(n,r),n.ShowYesNo=function(r,a,o,i,s,l,u){void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=null);var p=new n(r,function(){p.button_Yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){null!=i&&i(),p.Close()},p.button_Yes),p.button_No.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){null!=s&&s(),p.Close()},p.button_No)},a,o,e.YesNo);return p.button_Yes.visible=!0,p.button_No.visible=!0,null!=l&&(p.button_Yes.label=l),null!=u&&(p.button_No.label=u),t.UIManager.ShowUI(p),p},n.ShowOk=function(r,a,o,i,s){void 0===i&&(i=null),void 0===s&&(s=null);var l=new n(r,function(){l.button_Ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){null!=i&&i(),l.Close()},l.button_Ok)},a,o,e.OK);return l.button_Ok.visible=!0,null!=s&&(l.button_Ok.label=s),t.UIManager.ShowUI(l),l},n}(t.UI);t.MessageBox=r,__reflect(r.prototype,"Lib.MessageBox")
}(Lib||(Lib={}));var Lib;!function(t){var e=function(t){function e(e,r){void 0===e&&(e=null),void 0===r&&(r=null);var n=t.call(this,"",null!=e&&e.length>0?e:"LoadingView",r)||this;return n.resGroupCount=0,n.resGroupIndex=0,n}return __extends(e,t),e.prototype.onProgress=function(t,e){var r=Math.round((this.resGroupIndex+t/e)/this.resGroupCount*100);this.label_Progress.text="Loading..."+r},e.prototype.LoadResGroups=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:this.resGroupCount=t.Count,this.resGroupIndex=0,e.label=1;case 1:return this.resGroupIndex<this.resGroupCount?[4,RES.loadGroup(t.Get(this.resGroupIndex),0,this)]:[3,4];case 2:e.sent(),e.label=3;case 3:return this.resGroupIndex++,[3,1];case 4:return[2]}})})},e}(t.UI);t.LoadingView=e,__reflect(e.prototype,"Lib.LoadingView",["RES.PromiseTaskReporter"])}(Lib||(Lib={}));var DayDayUp;!function(t){var e;!function(t){t[t.None=0]="None",t[t.Init=1]="Init",t[t.Idle=2]="Idle",t[t.Run=3]="Run",t[t.JumpUp=4]="JumpUp",t[t.SuperJumpUp=5]="SuperJumpUp",t[t.Fall=6]="Fall",t[t.Hurt=7]="Hurt",t[t.Dead=8]="Dead"}(e=t.BattlefieldPlayerStateEnum||(t.BattlefieldPlayerStateEnum={}));var r=function(){function t(){this.hp=1,this.jumpPowerPerFrame=1,this.jumpPowerAtMaxFrameCount=1,this.superForcePerMaxJump=1,this.g=1,this.airSpeed=1,this.shotSpeed_cannon=1,this.runSpeed=1,this.runSpeeds=new Lib.Dictionary,this.jumpSpeed=1,this.jumpSpeeds=new Lib.Dictionary,this.superJumpSpeed=1,this.superJumpSpeeds=new Lib.Dictionary,this.elapseLifePerFrame_Quicksand=1,this.groundOffsetPerFrame=1}return t}();t.BattlefieldPlayerRates=r,__reflect(r.prototype,"DayDayUp.BattlefieldPlayerRates");var n=function(r){function n(){var t=null!==r&&r.apply(this,arguments)||this;return t.className=n.ClassName,t.stateNames=["None","Init","Idle","Run","JumpUp","SuperJumpUp","Fall","Hurt","Dead"],t.record_yMax=0,t.record_yOfJump=0,t.record_yOfFall=0,t.record_speedOfJump=0,t.record_speedOfJumpMax=0,t.record_levelAtOnceJump=0,t.record_levelAtOnceJumpMax=0,t.curPropFrameCounts=new Lib.Dictionary,t.curSuperForce=0,t.curJumpPower=0,t.curJumpPowerAtMaxFrameCount=0,t.curSpeedY=0,t.score=0,t.onHolding=!1,t.state=e.None,t.stateCount=0,t.atBoardId=-1,t.boardGroundOffset=0,t}return __extends(n,r),Object.defineProperty(n.prototype,"LevelMax",{get:function(){return Math.floor(-this.record_yMax/this.ownerBattlefield.setting.showHeight)},enumerable:!0,configurable:!0}),n.prototype.RecordJumpInfo=function(t){this.record_yOfJump=this.y,this.record_yOfFall=this.y,this.record_speedOfJump=t,this.record_speedOfJump<this.record_speedOfJumpMax&&(this.record_speedOfJumpMax=this.record_speedOfJump),this.record_levelAtOnceJump=0},n.prototype.RecordRefresh=function(){this.record_yMax>this.y&&(this.record_yMax=this.y),this.record_yOfFall>this.y&&(this.record_yOfFall=this.y);var t=Math.floor((this.record_yOfJump-this.record_yOfFall)/this.ownerBattlefield.setting.showHeight);this.record_levelAtOnceJump<t&&(this.record_levelAtOnceJump=t,this.record_levelAtOnceJumpMax<this.record_levelAtOnceJump&&(this.record_levelAtOnceJumpMax=this.record_levelAtOnceJump))},n.prototype.OnProp_Added=function(t){null!=this.onProp_Added&&this.onProp_Added(t)},n.prototype.OnProp_Removed=function(t){null!=this.onProp_Removed&&this.onProp_Removed(t)},n.prototype.AddProp=function(t){if(this.ownerBattlefield.setting.propFrameCounts.ContainsKey(t)){var e=this.ownerBattlefield.setting.propFrameCounts.Get(t);e>0&&(this.curPropFrameCounts.Set(t,e),this.OnProp_Added(t))}},n.prototype.GetPropLeftFrameCount=function(t){return this.curPropFrameCounts.ContainsKey(t)?this.curPropFrameCounts.Get(t):0},Object.defineProperty(n.prototype,"PropRate_G",{get:function(){return!this.curPropFrameCounts.ContainsKey(t.BattlefieldPropTypeEnum.Feather)||this.curPropFrameCounts.Get(t.BattlefieldPropTypeEnum.Feather)<=0?1:this.ownerBattlefield.setting.propRate_G_Feather},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PropRate_SpeedX",{get:function(){return!this.curPropFrameCounts.ContainsKey(t.BattlefieldPropTypeEnum.TurtleShell)||this.curPropFrameCounts.Get(t.BattlefieldPropTypeEnum.TurtleShell)<=0?1:this.ownerBattlefield.setting.propRate_SpeedX_TurtleShell},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PropRate_JumpPowerPerFrame",{get:function(){return!this.curPropFrameCounts.ContainsKey(t.BattlefieldPropTypeEnum.Drinks)||this.curPropFrameCounts.Get(t.BattlefieldPropTypeEnum.Drinks)<=0?1:this.ownerBattlefield.setting.propRate_JumpPowerPerFrame_Drinks},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PropRate_JumpSpeed",{get:function(){return!this.curPropFrameCounts.ContainsKey(t.BattlefieldPropTypeEnum.SpringShoe)||this.curPropFrameCounts.Get(t.BattlefieldPropTypeEnum.SpringShoe)<=0?1:this.ownerBattlefield.setting.propRate_JumpSpeed_SpringShoe},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PropRate_SuperJumpSpeed",{get:function(){return!this.curPropFrameCounts.ContainsKey(t.BattlefieldPropTypeEnum.SpringShoe)||this.curPropFrameCounts.Get(t.BattlefieldPropTypeEnum.SpringShoe)<=0?1:this.ownerBattlefield.setting.propRate_SuperJumpSpeed_SpringShoe},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ElapseLifePerFrame_Quicksand",{get:function(){return this.ownerBattlefield.setting.elapseLifePerFrame_Quicksand*this.rates.elapseLifePerFrame_Quicksand*this.PropRate_G},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"GroundOffsetPerFrame",{get:function(){var t=this.GetAtBoard();return null!=t?t.GetGroundOffsetPerFrame()*this.rates.groundOffsetPerFrame*this.PropRate_G:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"AtBoardId",{get:function(){return this.atBoardId},enumerable:!0,configurable:!0}),n.prototype.GetAtBoard=function(){return this.ownerBattlefield.boards.Get(this.atBoardId)},n.prototype.AdjustYAtBoard=function(){var t=this.GetAtBoard();null!=t&&(this.curSpeedY=0,this.y=t.y+t.body.top+this.boardGroundOffset-this.body.bottom)},n.prototype.IsAtBoard=function(){var t=this.GetAtBoard();return null==t?!1:this.x+this.body.left<t.x+t.body.right&&this.x+this.body.right>t.x+t.body.left},n.prototype.IsTouched_Board=function(e){return!e.needRemoved&&t.BattlefieldItem.Touched(this.x+this.body.x,this.y+this.body.y,this.body.width,this.body.height,e.x+e.body.x,e.y+e.body.y,e.body.width,e.body.height)},n.prototype.IsTouched_Prop=function(e){return!e.needRemoved&&t.BattlefieldItem.Touched(this.x+this.body.x,this.y+this.body.y,this.body.width,this.body.height,e.x+e.body.x,e.y+e.body.y,e.body.width,e.body.height)},Object.defineProperty(n.prototype,"Hp",{get:function(){return this.ownerBattlefield.setting.hp*this.rates.hp},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"SuperForcePerMaxJump",{get:function(){return this.ownerBattlefield.setting.superForcePerMaxJump*this.rates.superForcePerMaxJump},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"SuperForceMax",{get:function(){return this.ownerBattlefield.setting.superForceMax},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"JumpPowerPerFrame",{get:function(){return this.ownerBattlefield.setting.jumpPowerPerFrame*this.rates.jumpPowerPerFrame*this.PropRate_JumpPowerPerFrame},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"JumpPowerMax",{get:function(){return this.ownerBattlefield.setting.jumpPowerMax},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"JumpPowerAtMaxFrameCount",{get:function(){return this.ownerBattlefield.setting.jumpPowerAtMaxFrameCount*this.rates.jumpPowerAtMaxFrameCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"G",{get:function(){return this.ownerBattlefield.setting.g*this.rates.g*this.PropRate_G},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"AirSpeed",{get:function(){return this.ownerBattlefield.setting.airSpeed*this.rates.airSpeed*this.PropRate_SpeedX},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"RunSpeed",{get:function(){var t=this.GetAtBoard();return null!=t?this.rates.runSpeeds.ContainsKey(t.id)?this.ownerBattlefield.setting.runSpeed*t.GetPlayerRunSpeedRate()*this.rates.runSpeeds.Get(t.id)*this.PropRate_SpeedX:this.ownerBattlefield.setting.runSpeed*t.GetPlayerRunSpeedRate()*this.rates.runSpeed*this.PropRate_SpeedX:this.ownerBattlefield.setting.runSpeed*this.rates.runSpeed*this.PropRate_SpeedX},enumerable:!0,configurable:!0}),n.prototype.GetJumpSpeed=function(t){var e=this.ownerBattlefield.setting.jumpSpeedMin+(this.ownerBattlefield.setting.jumpSpeedMax-this.ownerBattlefield.setting.jumpSpeedMin)*t,r=this.GetAtBoard();return null!=r?this.rates.jumpSpeeds.ContainsKey(r.id)?e*r.GetPlayerJumpSpeedRate()*this.rates.jumpSpeeds.Get(r.id)*this.PropRate_JumpSpeed+r.GetLastDeltaY():e*r.GetPlayerJumpSpeedRate()*this.rates.jumpSpeed*this.PropRate_JumpSpeed+r.GetLastDeltaY():e*this.rates.jumpSpeed*this.PropRate_JumpSpeed},Object.defineProperty(n.prototype,"SuperJumpSpeed",{get:function(){var t=this.GetAtBoard();return null!=t?this.rates.superJumpSpeeds.ContainsKey(t.id)?this.ownerBattlefield.setting.superJumpSpeed*t.GetPlayerSuperJumpSpeedRate()*this.rates.superJumpSpeeds.Get(t.id)*this.PropRate_SuperJumpSpeed+t.GetLastDeltaY():this.ownerBattlefield.setting.superJumpSpeed*t.GetPlayerSuperJumpSpeedRate()*this.rates.superJumpSpeed*this.PropRate_SuperJumpSpeed+t.GetLastDeltaY():this.ownerBattlefield.setting.superJumpSpeed*this.rates.superJumpSpeed*this.PropRate_SuperJumpSpeed},enumerable:!0,configurable:!0}),n.prototype.MoveX=function(t,e){void 0===e&&(e=0),this.faceToRight?this.x+=e+t:this.x+=e-t},n.prototype.CheckTouchWall=function(){this.x+this.body.right>=this.ownerBattlefield.setting.showWidth&&(this.x=this.ownerBattlefield.setting.showWidth-this.body.right,this.faceToRight=!1),this.x+this.body.left<=0&&(this.x=-this.body.left,this.faceToRight=!0)},n.prototype.MoveY=function(t){var e=this;this.y+=this.curSpeedY;var r=!1;this.ownerBattlefield.boards.ForEach(function(n,a){e.IsTouched_Board(a)&&e.lastY+e.body.bottom<a.lastY+a.body.bottom&&(e.atBoardId=a.id,e.boardGroundOffset=0,e.AdjustYAtBoard(),null!=t&&t(),r=!0)},function(){return r}),r||(this.curSpeedY+=this.G)},n.prototype.AtEdge=function(t){var e=this.GetAtBoard();if(null==e)return!1;if(this.faceToRight){if(this.x+this.body.left+(this.RunSpeed+t)>=e.x+e.body.right)return!0}else if(this.x+this.body.right-(this.RunSpeed+t)<=e.x+e.body.left)return!0;return!1},n.New=function(t,e,r,a,o,i){var s=null==t?new n:t.Get(n.ClassName,function(){return new n});return s.Init_Player(e,r,a,o,i),s},n.prototype.Init_Player=function(t,n,a,o,i){r.prototype.Init.call(this,t,n,a),this.faceToRight=a,this.atBoardId=o;var s=.5,l=1.5;this.body.setTo(.5*-s,-l,s,l),this.rates=i,this.nextState=e.Init},n.prototype.Update=function(){var t=this;if(r.prototype.Update.call(this),this.nextState!=e.None){switch(this.nextState){case e.Init:break;case e.Idle:break;case e.Run:this.curSpeedY=0,this.curJumpPower=0,this.curJumpPowerAtMaxFrameCount=0;break;case e.JumpUp:this.curJumpPower>=this.JumpPowerMax&&this.curSuperForce++,this.curSpeedY=this.GetJumpSpeed(this.curJumpPower/this.JumpPowerMax),this.curJumpPower=0,this.atBoardId=-1,this.RecordJumpInfo(this.curSpeedY);break;case e.SuperJumpUp:this.curSpeedY=this.SuperJumpSpeed,this.curSuperForce=0,this.curJumpPower=0,this.atBoardId=-1,this.RecordJumpInfo(this.curSpeedY);break;case e.Fall:this.curJumpPower=0,this.atBoardId=-1;break;case e.Dead:}this.state==this.nextState?this.stateCount++:(this.stateCount=0,this.state=this.nextState),this.nextState=e.None}if(this.state!=e.None){switch(this.state){case e.Init:this.nextState=e.Idle;break;case e.Idle:this.nextState=e.Run;break;case e.Run:var n=this.GetAtBoard();null!=n?(this.onHolding?this.curJumpPower>=this.JumpPowerMax?(this.curJumpPowerAtMaxFrameCount++,this.curJumpPowerAtMaxFrameCount>=this.JumpPowerAtMaxFrameCount&&(this.curJumpPower=0,this.curJumpPowerAtMaxFrameCount=0)):(this.curJumpPower+=this.JumpPowerPerFrame,this.curJumpPower>this.JumpPowerMax&&(this.curJumpPower=this.JumpPowerMax)):this.curJumpPower>=this.JumpPowerMax&&this.curSuperForce>=this.SuperForceMax?this.nextState=e.SuperJumpUp:this.curJumpPower>0&&(this.nextState=e.JumpUp),this.nextState==e.None&&(this.MoveX(this.RunSpeed,n.GetLastDeltaX()+n.GetGroundSpeed()),this.IsAtBoard()?(this.boardGroundOffset+=this.GroundOffsetPerFrame,this.AdjustYAtBoard(),this.boardGroundOffset>n.GetGroundOffsetMax()&&(this.nextState=e.Fall)):this.nextState=e.Fall,this.CheckTouchWall())):this.nextState=e.Fall;break;case e.JumpUp:case e.SuperJumpUp:this.MoveX(this.AirSpeed),this.CheckTouchWall(),this.MoveY(function(){t.nextState=e.Run}),this.nextState==e.None&&this.curSpeedY>=0&&(this.nextState=e.Fall),this.RecordRefresh();break;case e.Fall:this.MoveX(this.AirSpeed),this.CheckTouchWall(),this.MoveY(function(){t.nextState=e.Run}),this.nextState==e.None&&this.y+this.body.top>this.ownerBattlefield.curBottomPos&&(this.nextState=e.Dead);break;case e.Dead:}if(this.state!=e.Dead&&this.nextState!=e.Dead){var a=new Lib.List;this.curPropFrameCounts.ForEachKey(function(e){var r=t.curPropFrameCounts.Get(e);1>=r?a.Add(e):t.curPropFrameCounts.Set(e,r-1)}),a.ForEach(function(e,r){t.curPropFrameCounts.Remove(r),t.OnProp_Removed(r)}),this.ownerBattlefield.props.ForEach(function(e,r){t.IsTouched_Prop(r)&&r.TouchPlayer(t)})}}},n.ClassName="BattlefieldPlayer",n}(t.BattlefieldItem);t.BattlefieldPlayer=n,__reflect(n.prototype,"DayDayUp.BattlefieldPlayer")}(DayDayUp||(DayDayUp={}));var Lib;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(eui.Button);t.VetorgramButton=e,__reflect(e.prototype,"Lib.VetorgramButton")}(Lib||(Lib={}));